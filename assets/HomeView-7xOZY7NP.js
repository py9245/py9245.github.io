import{r as u,w as E,o as X,u as Y,a as Z,c as i,b as e,n as m,t as o,d as ee,e as H,f as h,g as se,h as _,i as T,F as q,j as B,k as te,l as ae,v as le,m as oe,p as ne,q as ie,s as re,x as ue,y as ce,z as n,A as de,B as ve,C as me}from"./index-CT1FByBT.js";const he={class:"panel mb-4 animate-[float_8s_ease-in-out_infinite]"},_e={class:"d-flex flex-column flex-lg-row justify-content-between gap-4"},fe={class:"d-inline-flex align-items-center gap-2 mb-3 text-uppercase small fw-semibold"},be={class:"d-flex flex-wrap gap-3"},pe={class:"mini-stats row row-cols-1 g-3"},ge={class:"col"},ye={class:"card border-0 h-100 text-center py-3"},we={class:"text-light mb-0"},xe={class:"col"},ke={class:"card border-0 h-100 text-center py-3"},Re={class:"text-light mb-0"},qe={class:"col"},Ce={class:"card border-0 h-100 text-center py-3"},Ae={class:"text-light mb-0"},Pe={class:"random-chat-header"},Me={class:"random-chat-tabs"},Se=["disabled"],Le=["disabled"],Te={class:"random-status-row"},Be={class:"status-pill"},Ne={class:"status-pill"},Ve={class:"status-pill"},Ie={key:0,class:"alert alert-danger random-alert"},ze={key:1,class:"alert alert-warning random-alert"},De={key:0,class:"random-stream"},Ee={key:1,class:"random-placeholder"},He=["disabled"],Oe={key:0},Qe={key:1},je={class:"panel mb-4"},Fe={key:0,class:"alert alert-danger"},Je={key:1,class:"panel-placeholder"},Ke={key:2,class:"row g-4"},Ue={class:"card h-100 border-0 fade-card"},$e={class:"card-body d-flex flex-column gap-2"},Ge={class:"badge bg-secondary text-uppercase w-auto"},We={class:"card-title text-light mb-0"},Xe={class:"card-text text-white-50 flex-grow-1"},Ye={class:"panel"},Ze={key:0,class:"row g-3"},es={class:"card border-0 h-100 mini-stat-card"},ss={class:"card-body"},ts={class:"text-white-50 mb-1"},as={class:"text-light mb-2"},ls={class:"text-white-50"},os={class:"mb-0 text-white-50"},ns={key:1,class:"panel-placeholder"},is=2e3,cs={__name:"HomeView",setup(rs){const C=u({ok:null,text:"API 상태 확인 중..."}),N=u([]),A=u([]),f=u({users:0,posts:0,messages:0}),P=u(!0),b=u(""),{profile:c,ensureProfileLoaded:O}=Y(),M=u(null),l=u({in_queue:!1,queue_position:null,queue_size:0,session:null,messages:[]}),S=u("idle"),r=u(""),p=u(!1),g=u(!1),y=u(!1),v=u(!1),d=u(""),Q=/010-\d{4}-\d{4}/;let w=null;const x=(s,t)=>s?s.status===401?"랜덤 채팅은 로그인 후 이용할 수 있습니다.":s.status===404?"랜덤 채팅 서버가 아직 업데이트되지 않았습니다. 잠시 후 다시 시도해 주세요.":s?.payload?.detail||t:t,k=(s={})=>{l.value={in_queue:!!s?.in_queue,queue_position:s?.queue_position??null,queue_size:s?.queue_size??0,session:s?.session||null,messages:Array.isArray(s?.messages)?s.messages:[]}},V=async()=>{P.value=!0,b.value="";try{const[s,t]=await Promise.all([oe(),ne()]);C.value={ok:!!s?.ok,text:s?.ok?"API 정상 동작 중":"API 응답 이상"},N.value=Array.isArray(t?.sections)?t.sections:[],A.value=Array.isArray(t?.stats)?t.stats:[],f.value=t?.totals??{users:0,posts:0,messages:0}}catch(s){console.error(s),b.value="메인 데이터를 불러오지 못했습니다."}finally{P.value=!1}},I=()=>c.value?(r.value="",!0):(r.value="랜덤 채팅은 로그인 후 이용할 수 있습니다.",!1),z=async()=>{if(c.value){p.value=!0,r.value="";try{const s=await ce({limit:60});k(s)}catch(s){console.error(s),r.value=x(s,"랜덤 채팅 상태를 불러오지 못했습니다.")}finally{p.value=!1}}},L=async s=>{S.value=s,s==="queue"?await j():s==="match"&&await J()},j=async()=>{if(I()&&!g.value){g.value=!0,r.value="";try{const s=await re();k(s)}catch(s){console.error(s),r.value=x(s,"대기열에 들어가지 못했습니다.")}finally{g.value=!1}}},F=async()=>{if(c.value){r.value="";try{await ie(),await z()}catch(s){console.error(s),r.value=x(s,"대기열에서 나갈 수 없습니다.")}}},J=async()=>{if(I()&&!y.value){y.value=!0,r.value="";try{const s=await ue();k(s),d.value=""}catch(s){console.error(s),r.value=x(s,"랜덤 매칭에 실패했습니다.")}finally{y.value=!1}}},K=async()=>{if(!(!c.value||!l.value.session))try{const s=await me({limit:60});Array.isArray(s?.messages)&&(l.value={...l.value,messages:s.messages})}catch(s){console.error(s)}},U=async()=>{if(!c.value||!l.value.session){r.value="매칭 후 메시지를 보낼 수 있습니다.";return}const s=d.value.trim();if(!s){r.value="메시지를 입력해 주세요.";return}if(Q.test(s)){r.value="전화번호 형식(010-0000-0000)은 전송할 수 없습니다.";return}if(!v.value){v.value=!0,r.value="";try{const t=await ve({content:s});l.value={...l.value,messages:[...l.value.messages,t]},d.value=""}catch(t){console.error(t),r.value=t?.payload?.detail||"메시지를 보내지 못했습니다."}finally{v.value=!1}}},$=()=>{M.value&&M.value.scrollIntoView({behavior:"smooth",block:"start"})},G=async()=>{$(),await L("queue")},W=()=>{R(),l.value.session&&(w=window.setInterval(()=>{K()},is))},R=()=>{w&&(clearInterval(w),w=null)};return E(()=>l.value.session?.id,(s,t)=>{s!==t&&W(),s||R()}),E(()=>c.value,s=>{s?z():(R(),k({}),d.value="")},{immediate:!0}),X(async()=>{await O(),V()}),Z(()=>{R()}),(s,t)=>{const D=se("router-link");return n(),i(q,null,[e("section",he,[e("div",_e,[e("div",null,[e("div",fe,[e("span",{class:m(["badge",C.value.ok?"bg-success":"bg-danger"])},null,2),e("span",null,o(C.value.text),1)]),t[4]||(t[4]=e("h1",{class:"display-5 fw-semibold text-light mb-3"},"익명 랜덤 채팅 허브",-1)),t[5]||(t[5]=e("p",{class:"text-white-50 mb-4"}," 대기열 진입부터 1:1 매칭, 메시지까지 한 화면에서 제어하세요. 연락처(010-0000-0000) 등 개인정보는 자동으로 차단됩니다. ",-1)),e("div",be,[e("button",{class:"btn btn-primary btn-lg shadow nav-hover",type:"button",onClick:G}," 랜덤채팅 바로가기 "),ee(D,{class:"btn btn-outline-light btn-lg nav-hover",to:"/chat"},{default:H(()=>[...t[3]||(t[3]=[h("공개 채팅방 보기",-1)])]),_:1})])]),e("div",pe,[e("div",ge,[e("div",ye,[t[6]||(t[6]=e("p",{class:"text-white-50 mb-1"},"총 게시글",-1)),e("h2",we,o(f.value.posts),1)])]),e("div",xe,[e("div",ke,[t[7]||(t[7]=e("p",{class:"text-white-50 mb-1"},"채팅 메시지",-1)),e("h2",Re,o(f.value.messages),1)])]),e("div",qe,[e("div",Ce,[t[8]||(t[8]=e("p",{class:"text-white-50 mb-1"},"계정 수",-1)),e("h2",Ae,o(f.value.users),1)])])])])]),e("section",{ref_key:"randomPanelRef",ref:M,class:"panel random-chat-panel mb-4"},[e("div",Pe,[t[9]||(t[9]=e("div",null,[e("span",{class:"random-chip"},"랜덤 채팅"),e("h2",{class:"random-title"},"한 번의 탭으로 익명 1:1 매칭"),e("p",{class:"random-subtitle"},[e("strong",null,"대기열 진입"),h("을 누르면 익명 대기열에 합류하고, "),e("strong",null,"채팅하기"),h("는 본인을 제외한 다른 이용자와 즉시 연결합니다. 모든 대화는 익명으로만 진행됩니다. ")])],-1)),e("div",Me,[e("button",{class:m(["random-chat-tab",{active:S.value==="queue"}]),disabled:g.value||p.value,type:"button",onClick:t[0]||(t[0]=a=>L("queue"))}," 대기열 진입 ",10,Se),e("button",{class:m(["random-chat-tab",{active:S.value==="match"}]),disabled:y.value||p.value,type:"button",onClick:t[1]||(t[1]=a=>L("match"))}," 채팅하기 ",10,Le)])]),e("div",Te,[e("div",Be,[t[10]||(t[10]=e("span",{class:"label"},"대기열",-1)),e("strong",null,o(l.value.queue_size)+"명",1)]),e("div",Ne,[t[11]||(t[11]=e("span",{class:"label"},"내 순서",-1)),e("strong",null,o(l.value.queue_position??"-"),1)]),e("div",Ve,[t[12]||(t[12]=e("span",{class:"label"},"현재 상태",-1)),e("strong",null,o(l.value.session?l.value.session.partner_alias+" 연결됨":l.value.in_queue?"대기 중":"탭을 눌러 시작하세요"),1)]),l.value.in_queue?(n(),i("button",{key:0,class:"btn btn-outline-secondary nav-hover ms-auto random-leave-btn",type:"button",onClick:F}," 대기열 나가기 ")):_("",!0)]),r.value?(n(),i("div",Ie,o(r.value),1)):_("",!0),T(c)?_("",!0):(n(),i("div",ze," 로그인한 사용자만 랜덤 채팅에 참여할 수 있습니다. 계정 탭에서 로그인해 주세요. ")),e("div",{class:m(["random-chat-body",{disabled:!T(c)}])},[l.value.session&&l.value.messages.length?(n(),i("div",De,[(n(!0),i(q,null,B(l.value.messages,a=>(n(),i("article",{key:a.id,class:m(["random-chat-message",{me:a.from_self}])},[e("small",null,o(a.from_self?"나":l.value.session.partner_alias),1),e("p",null,o(a.content),1),e("time",null,o(new Date(a.created_at).toLocaleTimeString("ko-KR")),1)],2))),128))])):(n(),i("div",Ee,o(l.value.session?"아직 대화가 없습니다. 첫 메시지를 보내보세요!":"대기열에 합류하고 채팅하기를 누르면 새로운 익명 채팅방이 열립니다."),1)),T(c)&&l.value.session?(n(),i("form",{key:2,class:"random-chat-form",autocomplete:"off",onSubmit:te(U,["prevent"])},[ae(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),class:"form-control",maxlength:"500",placeholder:"010-0000-0000 형식의 연락처는 전송이 제한됩니다."},null,512),[[le,d.value]]),e("button",{class:"btn btn-light nav-hover",disabled:v.value||!d.value.trim(),type:"submit"},[v.value?(n(),i("span",Oe,"전송 중...")):(n(),i("span",Qe,"메시지 전송"))],8,He)],32)):_("",!0)],2)],512),e("section",je,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t[13]||(t[13]=e("div",null,[e("h2",{class:"h4 text-light mb-1"},"애플리케이션 개요"),e("p",{class:"text-white-50 mb-0"},"각 영역은 독립 라우트/앱으로 나뉘어 있습니다.")],-1)),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:V},"새로 고침")]),b.value?(n(),i("div",Fe,o(b.value),1)):P.value?(n(),i("div",Je,"데이터를 불러오는 중...")):(n(),i("div",Ke,[(n(!0),i(q,null,B(N.value,a=>(n(),i("div",{key:a.id,class:"col-12 col-md-6 col-xl-3"},[e("div",Ue,[e("div",$e,[e("span",Ge,o(a.slug),1),e("h5",We,o(a.title),1),e("p",Xe,o(a.description),1),a.cta_link?(n(),de(D,{key:0,class:"btn btn-sm btn-outline-light align-self-start nav-hover",to:a.cta_link},{default:H(()=>[h(o(a.cta_label||"바로가기"),1)]),_:2},1032,["to"])):_("",!0)])])]))),128))]))]),e("section",Ye,[t[14]||(t[14]=e("div",{class:"mb-3"},[e("h2",{class:"h4 text-light mb-1"},"운영 수치"),e("p",{class:"text-white-50 mb-0"},"DB, 백엔드, 프런트엔드가 공유하는 제약 조건입니다.")],-1)),A.value.length?(n(),i("div",Ze,[(n(!0),i(q,null,B(A.value,a=>(n(),i("div",{key:a.id,class:"col-12 col-md-6 col-xl-4"},[e("div",es,[e("div",ss,[e("p",ts,o(a.name),1),e("h3",as,[h(o(a.value)+" ",1),e("small",ls,o(a.unit),1)]),e("p",os,o(a.description),1)])])]))),128))])):(n(),i("p",ns,"등록된 지표가 없습니다."))])],64)}}};export{cs as default};
