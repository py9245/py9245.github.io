import{r,p as $,o as T,u as K,a as n,b as e,l as f,q as F,s as p,v as x,t as u,x as M,F as R,g as W,y as G,j as o,n as H,z as J,A as O,B as Q,C as X}from"./index-BBrtxs94.js";const Y={class:"panel"},Z={key:0,class:"post-form mb-4"},tt={class:"col-12"},et={class:"col-12"},at={class:"col-12"},lt={class:"d-flex flex-column flex-lg-row gap-3 align-items-lg-center"},st={class:"text-white-50"},nt={class:"col-12 d-flex gap-3 flex-wrap"},ot=["disabled"],it={key:0},rt={key:1},ct={key:1,class:"alert alert-warning"},dt={key:2,class:"text-success fw-semibold"},ut={key:3,class:"text-danger fw-semibold"},mt={key:4,class:"panel-placeholder"},ht={key:5,class:"panel-placeholder"},ft={key:6,class:"d-flex flex-column gap-3"},pt={class:"d-flex justify-content-between gap-3 flex-wrap"},vt={class:"mb-1 text-light"},bt={class:"text-white-50"},yt={class:"text-white-50"},_t={key:0,class:"text-white-50 mt-2 mb-0"},xt=["href"],gt={key:2,class:"d-flex gap-2 flex-wrap mt-3"},wt=["onClick"],kt=["disabled","onClick"],At={key:0},Ct={key:1},St={class:"mb-3"},Pt={class:"mb-3"},Bt={class:"mb-3"},Dt={class:"d-flex flex-column flex-lg-row gap-3 align-items-lg-center"},$t=["for"],Ft={class:"text-white-50"},Mt=["id"],Vt={class:"form-check form-switch mb-3"},Et=["id","disabled"],Nt=["for"],zt={class:"d-flex gap-3 flex-wrap"},Ut=["disabled"],It={key:0},jt={key:1},Tt={__name:"BoardsView",setup(qt){const{profile:g,ensureProfileLoaded:V}=K(),d=r([]),w=r(!0),c=r(""),v=r(""),b=r(!1),i=$({title:"",body:"",attachment:null}),k=r(""),A=r(null),m=r(null),s=$({title:"",body:"",attachment:null,clearAttachment:!1}),C=r(""),S=r(null),y=r(!1),_=r(null),E=a=>{if(!a)return"";const t=typeof a=="string"?new Date(a):a;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"long",timeStyle:"short"}).format(t)},N=a=>{const[t]=a.target.files||[];i.attachment=t||null,k.value=t?`${t.name} (${(t.size/(1024*1024)).toFixed(2)}MB)`:""},z=()=>{i.attachment=null,k.value="",A.value&&(A.value.value="")},B=()=>{s.attachment=null,C.value="",S.value&&(S.value.value="")},D=async()=>{w.value=!0;try{const a=await G();d.value=Array.isArray(a?.posts)?a.posts:[]}catch(a){console.error(a),c.value="게시글을 불러오지 못했습니다."}finally{w.value=!1}},U=async()=>{if(c.value="",v.value="",!g.value){c.value="로그인 후 이용해 주세요.";return}if(!i.title.trim()){c.value="제목을 입력해 주세요.";return}b.value=!0;try{const a=new FormData;a.append("title",i.title.trim()),a.append("body",i.body.trim()),i.attachment&&a.append("attachment",i.attachment);const t=await O(a);d.value=[t,...d.value],i.title="",i.body="",z(),v.value="게시글이 등록되었습니다."}catch(a){console.error(a),c.value=a?.payload?.detail||(Array.isArray(a?.payload?.non_field_errors)?a.payload.non_field_errors.join(" "):"게시글을 저장하지 못했습니다.")}finally{b.value=!1}},I=a=>{m.value=a.id,s.title=a.title,s.body=a.body||"",s.clearAttachment=!1,B()},P=()=>{m.value=null,s.title="",s.body="",s.clearAttachment=!1,B()},j=a=>{const[t]=a.target.files||[];s.attachment=t||null,C.value=t?`${t.name} (${(t.size/(1024*1024)).toFixed(2)}MB)`:"",t&&(s.clearAttachment=!1)},q=async()=>{if(m.value){c.value="",y.value=!0;try{const a=new FormData;a.append("title",s.title.trim()),a.append("body",s.body.trim()),s.attachment&&a.append("attachment",s.attachment),s.clearAttachment&&!s.attachment&&a.append("clear_attachment","1");const t=await X(m.value,a);d.value=d.value.map(l=>l.id===t.post.id?t.post:l),P()}catch(a){console.error(a),c.value=a?.payload?.detail||"게시글을 수정하지 못했습니다."}finally{y.value=!1}}},L=async a=>{if(window.confirm("해당 게시글을 삭제하시겠습니까?")){c.value="",_.value=a;try{await Q(a),d.value=d.value.filter(t=>t.id!==a),m.value===a&&P()}catch(t){console.error(t),c.value=t?.payload?.detail||"게시글을 삭제하지 못했습니다."}finally{_.value=null}}};return T(async()=>{await Promise.all([V(),D()])}),(a,t)=>(o(),n("section",Y,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t[5]||(t[5]=e("div",null,[e("h2",{class:"h4 text-light mb-1"},"파일 첨부 게시판"),e("p",{class:"text-white-50 mb-0"},"첨부파일은 AWS S3에 저장되며 계정당 하루 5개까지 작성 가능합니다.")],-1)),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:D},"새로 고침")]),F(g)?(o(),n("div",Z,[e("form",{class:"row g-3",autocomplete:"off",onSubmit:M(U,["prevent"])},[e("div",tt,[t[6]||(t[6]=e("label",{class:"form-label text-white-50"},"제목",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>i.title=l),class:"form-control",placeholder:"게시글 제목",required:""},null,512),[[x,i.title]])]),e("div",et,[t[7]||(t[7]=e("label",{class:"form-label text-white-50"},"내용",-1)),p(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>i.body=l),class:"form-control",rows:"4",placeholder:"전하고 싶은 이야기를 적어보세요"},null,512),[[x,i.body]])]),e("div",at,[t[9]||(t[9]=e("label",{class:"form-label text-white-50"},"첨부파일",-1)),e("div",lt,[t[8]||(t[8]=e("label",{class:"btn btn-outline-light w-100 w-lg-auto nav-hover mb-0",for:"post-attachment"}," 파일 선택 ",-1)),e("span",st,u(k.value||"최대 5MB, 이미지·문서 업로드 지원"),1)]),e("input",{id:"post-attachment",ref_key:"attachmentInput",ref:A,type:"file",class:"d-none",accept:"image/*,application/pdf,application/zip,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt",onChange:N},null,544)]),e("div",nt,[e("button",{class:"btn btn-primary nav-hover",disabled:b.value,type:"submit"},[b.value?(o(),n("span",it,"업로드 중...")):(o(),n("span",rt,"게시글 등록"))],8,ot),t[10]||(t[10]=e("p",{class:"text-white-50 mb-0"},"파일은 최대 5MB, 하루 5개의 게시글 제한이 적용됩니다.",-1))])],32)])):(o(),n("div",ct,"로그인한 사용자만 게시글을 작성할 수 있습니다.")),v.value?(o(),n("p",dt,u(v.value),1)):f("",!0),c.value?(o(),n("p",ut,u(c.value),1)):f("",!0),w.value?(o(),n("div",mt,"게시글을 불러오는 중...")):d.value.length?(o(),n("div",ft,[(o(!0),n(R,null,W(d.value,l=>(o(),n("article",{key:l.id,class:H(["post-card",{editing:m.value===l.id}])},[e("div",pt,[e("div",null,[e("h5",vt,u(l.title),1),e("small",bt,"@"+u(l.author?.username||"알 수 없음"),1)]),e("time",yt,u(E(l.created_at)),1)]),l.body?(o(),n("p",_t,u(l.body),1)):f("",!0),l.attachment_url?(o(),n("a",{key:1,href:l.attachment_url,class:"btn btn-sm btn-outline-light mt-3 nav-hover",target:"_blank",rel:"noreferrer"}," 첨부파일 다운로드 ",8,xt)):f("",!0),F(g)?.user?.id===l.author?.id?(o(),n("div",gt,[e("button",{class:"btn btn-outline-info btn-sm nav-hover",type:"button",onClick:h=>I(l)},"수정",8,wt),e("button",{class:"btn btn-outline-danger btn-sm nav-hover",type:"button",disabled:_.value===l.id,onClick:h=>L(l.id)},[_.value===l.id?(o(),n("span",At,"삭제 중...")):(o(),n("span",Ct,"삭제"))],8,kt)])):f("",!0),m.value===l.id?(o(),n("form",{key:3,class:"mt-3 border-top pt-3",autocomplete:"off",onSubmit:M(q,["prevent"])},[e("div",St,[t[11]||(t[11]=e("label",{class:"form-label text-white-50"},"제목",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=h=>s.title=h),class:"form-control",required:""},null,512),[[x,s.title]])]),e("div",Pt,[t[12]||(t[12]=e("label",{class:"form-label text-white-50"},"내용",-1)),p(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=h=>s.body=h),class:"form-control",rows:"3"},null,512),[[x,s.body]])]),e("div",Bt,[t[13]||(t[13]=e("label",{class:"form-label text-white-50"},"새 첨부파일",-1)),e("div",Dt,[e("label",{class:"btn btn-outline-light w-100 w-lg-auto nav-hover mb-0",for:`edit-attachment-${l.id}`}," 파일 선택 ",8,$t),e("span",Ft,u(C.value||"선택하지 않으면 기존 파일 유지"),1)]),e("input",{id:`edit-attachment-${l.id}`,ref_for:!0,ref_key:"editAttachmentInput",ref:S,type:"file",class:"d-none",accept:"image/*,application/pdf,application/zip,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt",onChange:j},null,40,Mt)]),e("div",Vt,[p(e("input",{id:`clear-attachment-${l.id}`,"onUpdate:modelValue":t[4]||(t[4]=h=>s.clearAttachment=h),class:"form-check-input",type:"checkbox",disabled:!!s.attachment},null,8,Et),[[J,s.clearAttachment]]),e("label",{class:"form-check-label text-white-50",for:`clear-attachment-${l.id}`},"기존 첨부 삭제",8,Nt)]),e("div",zt,[e("button",{class:"btn btn-primary nav-hover",disabled:y.value,type:"submit"},[y.value?(o(),n("span",It,"저장 중...")):(o(),n("span",jt,"수정 완료"))],8,Ut),e("button",{class:"btn btn-outline-light nav-hover",type:"button",onClick:P},"수정 취소")])],32)):f("",!0)],2))),128))])):(o(),n("div",ht,"아직 게시글이 없습니다. 첫 글을 남겨보세요!"))]))}};export{Tt as default};
