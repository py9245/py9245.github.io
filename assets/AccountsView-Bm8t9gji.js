import{l as f,r as v,B as R,u as G,o as H,c as a,a as s,k as S,m as _,d as J,t as y,q as x,p as i,v as c,C as K,D as $,i as n,E as z,G as Q,H as W,I as X,J as Y}from"./index-DyON2xhr.js";const Z={class:"panel"},ss={key:0,class:"row g-4"},es={class:"col-12 col-lg-6"},ts={class:"card h-100 border-0"},os={class:"card-body d-flex flex-column gap-3"},ls={class:"d-flex gap-3 align-items-center"},as=["src"],ns={class:"mb-1 text-light fw-semibold"},rs={key:0},ds={class:"mb-1 text-white-50"},is={class:"mb-0 text-white-50"},cs={class:"col-12 col-lg-6"},us={class:"card h-100 border-0"},ps={class:"card-body"},ms={class:"col-12"},bs={class:"col-12"},vs={class:"col-12"},fs=["disabled"],_s={key:0},ys={key:1},ws={class:"col-12 col-lg-6"},hs={class:"card border-0 h-100"},gs={class:"card-body d-flex flex-column gap-3"},xs=["disabled"],ks={key:0},Us={key:1},Vs={class:"col-12 col-lg-6"},qs={class:"card border-0 h-100"},Fs={class:"card-body"},Ps={class:"col-12"},Ss={class:"col-12"},js={class:"col-12"},As=["disabled"],Cs={key:0},Ds={key:1},Bs={class:"col-12 col-lg-6"},Ls={class:"card border-0 h-100"},Ms={class:"card-body"},Ns={class:"col-12"},Ts={class:"col-12 d-flex gap-3 flex-wrap"},Es=["disabled"],Is={key:0},Os={key:1},Rs={key:1,class:"row g-4"},Gs={class:"col-12 col-lg-6"},Hs={class:"card border-0 h-100"},Js={class:"card-body"},Ks={class:"col-12"},$s={class:"col-12"},zs={class:"col-12"},Qs={class:"col-12"},Ws={class:"col-12"},Xs=["disabled"],Ys={key:0},Zs={key:1},se={class:"col-12 col-lg-6"},ee={class:"card border-0 h-100"},te={class:"card-body"},oe={class:"col-12"},le={class:"col-12"},ae={class:"col-12"},ne=["disabled"],re={key:0},de={key:1},ie={key:2,class:"mt-4 text-success text-center fw-semibold"},ce={key:3,class:"mt-2 text-danger text-center fw-semibold"},me={__name:"AccountsView",setup(ue){const{profile:d,setSession:w,clearSession:A,ensureProfileLoaded:D}=G(),r=f({username:"",email:"",password:"",name:""}),u=f({username:"",password:""}),p=f({display_name:"",bio:""}),m=f({current_password:"",new_password:""}),h=v(null),g=f({password:""}),l=f({success:"",error:""}),k=v(!1),U=v(!1),V=v(!1),q=v(!1),F=v(!1),P=v(!1),C=R(()=>d.value?.avatar_url||""),b=()=>{l.success="",l.error=""},j=()=>{p.display_name=d.value?.display_name||"",p.bio=d.value?.bio||""},B=async()=>{b(),k.value=!0;try{const t=await X({username:r.username.trim(),email:r.email.trim(),password:r.password,name:r.name.trim()});w(t.token,t.profile),j(),r.username="",r.email="",r.password="",r.name="",l.success="회원가입이 완료되었습니다."}catch(t){l.error=t?.payload?.detail||"회원가입에 실패했습니다."}finally{k.value=!1}},L=async()=>{b(),U.value=!0;try{const t=await Y({username:u.username.trim(),password:u.password});w(t.token,t.profile),j(),u.username="",u.password="",l.success="로그인이 완료되었습니다."}catch(t){l.error=t?.payload?.detail||"로그인에 실패했습니다."}finally{U.value=!1}},M=async()=>{b();try{await K()}catch(t){console.warn("로그아웃 요청 실패",t)}finally{A(),l.success="로그아웃되었습니다."}},N=async()=>{b(),V.value=!0;try{const t=await z({display_name:p.display_name,bio:p.bio});w(void 0,t.profile),l.success="프로필을 업데이트했습니다."}catch(t){l.error=t?.payload?.detail||"프로필을 수정하지 못했습니다."}finally{V.value=!1}},T=t=>{const[e]=t.target.files||[];h.value=e||null},E=async()=>{if(h.value){b(),F.value=!0;try{const t=new FormData;t.append("avatar",h.value);const e=await $(t);w(void 0,e.profile),h.value=null,l.success="아바타를 업데이트했습니다."}catch(t){l.error=t?.payload?.detail||"아바타 업로드에 실패했습니다."}finally{F.value=!1}}},I=async()=>{b(),q.value=!0;try{const t=await Q({current_password:m.current_password,new_password:m.new_password});t?.token&&w(t.token,d.value),m.current_password="",m.new_password="",l.success="비밀번호가 변경되었습니다."}catch(t){l.error=t?.payload?.detail||(t?.payload&&typeof t.payload=="object"?Object.values(t.payload).flat().join(" "):"비밀번호를 변경하지 못했습니다.")}finally{q.value=!1}},O=async()=>{if(b(),!g.password){l.error="비밀번호를 입력해 주세요.";return}if(window.confirm("정말로 계정을 삭제하시겠습니까? 복구할 수 없습니다.")){P.value=!0;try{await W({password:g.password}),g.password="",A(),l.success="회원 탈퇴가 완료되었습니다."}catch(t){l.error=t?.payload?.detail||(t?.payload&&typeof t.payload=="object"?Object.values(t.payload).flat().join(" "):"회원 탈퇴 중 오류가 발생했습니다.")}finally{P.value=!1}}};return H(async()=>{await D(),d.value&&j()}),(t,e)=>(n(),a("section",Z,[e[31]||(e[31]=s("div",{class:"d-flex justify-content-between align-items-center mb-3"},[s("div",null,[s("h2",{class:"h4 text-light mb-1"},"계정 관리"),s("p",{class:"text-white-50 mb-0"},"Token 인증 기반으로 회원정보를 조회·수정합니다.")])],-1)),_(d)?(n(),a("div",ss,[s("div",es,[s("div",ts,[s("div",os,[s("div",{class:"d-flex justify-content-between align-items-center"},[e[11]||(e[11]=s("h5",{class:"text-light mb-0"},"내 계정",-1)),s("button",{class:"btn btn-outline-light btn-sm nav-hover",type:"button",onClick:M},"로그아웃")]),s("div",ls,[C.value?(n(),a("img",{key:0,src:C.value,alt:"avatar",class:"rounded-4 border border-secondary",width:"72",height:"72"},null,8,as)):S("",!0),s("div",null,[s("p",ns,[_(d).user.first_name?(n(),a("span",rs,y(_(d).user.first_name)+" · ",1)):S("",!0),J("@"+y(_(d).user.username),1)]),s("p",ds,y(_(d).user.email||"이메일 정보 없음"),1),s("p",is,y(_(d).bio||"소개글이 없습니다."),1)])])])])]),s("div",cs,[s("div",us,[s("div",ps,[e[14]||(e[14]=s("h5",{class:"text-light mb-3"},"프로필 수정",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:x(N,["prevent"])},[s("div",ms,[e[12]||(e[12]=s("label",{class:"form-label text-white-50"},"표시 이름",-1)),i(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.display_name=o),class:"form-control",placeholder:"공개 이름"},null,512),[[c,p.display_name]])]),s("div",bs,[e[13]||(e[13]=s("label",{class:"form-label text-white-50"},"소개",-1)),i(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>p.bio=o),class:"form-control",rows:"3",placeholder:"자기 소개를 입력해 주세요"},null,512),[[c,p.bio]])]),s("div",vs,[s("button",{class:"btn btn-primary nav-hover",disabled:V.value,type:"submit"},[V.value?(n(),a("span",_s,"저장 중...")):(n(),a("span",ys,"프로필 저장"))],8,fs)])],32)])])]),s("div",ws,[s("div",hs,[s("div",gs,[e[15]||(e[15]=s("h5",{class:"text-light"},"아바타",-1)),s("input",{class:"form-control",type:"file",accept:"image/*",onChange:T},null,32),e[16]||(e[16]=s("small",{class:"text-white-50"},"※ 최대 200KB 이미지 파일만 업로드할 수 있습니다.",-1)),s("button",{class:"btn btn-outline-light nav-hover",disabled:F.value||!h.value,type:"button",onClick:E},[F.value?(n(),a("span",ks,"업로드 중...")):(n(),a("span",Us,"아바타 업로드"))],8,xs)])])]),s("div",Vs,[s("div",qs,[s("div",Fs,[e[19]||(e[19]=s("h5",{class:"text-light mb-3"},"비밀번호 변경",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:x(I,["prevent"])},[s("div",Ps,[e[17]||(e[17]=s("label",{class:"form-label text-white-50"},"현재 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>m.current_password=o),class:"form-control",type:"password",required:""},null,512),[[c,m.current_password]])]),s("div",Ss,[e[18]||(e[18]=s("label",{class:"form-label text-white-50"},"새 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>m.new_password=o),class:"form-control",type:"password",minlength:"8",required:""},null,512),[[c,m.new_password]])]),s("div",js,[s("button",{class:"btn btn-primary nav-hover",disabled:q.value,type:"submit"},[q.value?(n(),a("span",Cs,"변경 중...")):(n(),a("span",Ds,"비밀번호 변경"))],8,As)])],32)])])]),s("div",Bs,[s("div",Ls,[s("div",Ms,[e[21]||(e[21]=s("h5",{class:"text-light mb-3"},"회원 탈퇴",-1)),e[22]||(e[22]=s("p",{class:"text-white-50 small"},"계정과 모든 연관 데이터를 삭제합니다. 삭제 후에는 복구할 수 없습니다.",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:x(O,["prevent"])},[s("div",Ns,[e[20]||(e[20]=s("label",{class:"form-label text-white-50"},"비밀번호 확인",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>g.password=o),class:"form-control",type:"password",required:""},null,512),[[c,g.password]])]),s("div",Ts,[s("button",{class:"btn btn-danger nav-hover",disabled:P.value,type:"submit"},[P.value?(n(),a("span",Is,"삭제 중...")):(n(),a("span",Os,"회원 탈퇴"))],8,Es)])],32)])])])])):(n(),a("div",Rs,[s("div",Gs,[s("div",Hs,[s("div",Js,[e[27]||(e[27]=s("h5",{class:"text-light mb-3"},"회원가입",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:x(B,["prevent"])},[s("div",Ks,[e[23]||(e[23]=s("label",{class:"form-label text-white-50"},"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.username=o),class:"form-control",placeholder:"예) new_user",minlength:"3",required:""},null,512),[[c,r.username]])]),s("div",$s,[e[24]||(e[24]=s("label",{class:"form-label text-white-50"},"이름",-1)),i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.name=o),class:"form-control",placeholder:"한글 2~5글자",pattern:"^[가-힣]{2,5}$",required:""},null,512),[[c,r.name]])]),s("div",zs,[e[25]||(e[25]=s("label",{class:"form-label text-white-50"},"이메일",-1)),i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.email=o),class:"form-control",type:"email",placeholder:"you@example.com",required:""},null,512),[[c,r.email]])]),s("div",Qs,[e[26]||(e[26]=s("label",{class:"form-label text-white-50"},"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>r.password=o),class:"form-control",type:"password",placeholder:"8자 이상",minlength:"8",required:""},null,512),[[c,r.password]])]),s("div",Ws,[s("button",{class:"btn btn-primary nav-hover",disabled:k.value,type:"submit"},[k.value?(n(),a("span",Ys,"가입 중...")):(n(),a("span",Zs,"회원가입"))],8,Xs)])],32)])])]),s("div",se,[s("div",ee,[s("div",te,[e[30]||(e[30]=s("h5",{class:"text-light mb-3"},"로그인",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:x(L,["prevent"])},[s("div",oe,[e[28]||(e[28]=s("label",{class:"form-label text-white-50"},"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>u.username=o),class:"form-control",placeholder:"아이디를 입력하세요",required:""},null,512),[[c,u.username]])]),s("div",le,[e[29]||(e[29]=s("label",{class:"form-label text-white-50"},"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>u.password=o),class:"form-control",type:"password",placeholder:"비밀번호를 입력하세요",required:""},null,512),[[c,u.password]])]),s("div",ae,[s("button",{class:"btn btn-outline-light nav-hover",disabled:U.value,type:"submit"},[U.value?(n(),a("span",re,"로그인 중...")):(n(),a("span",de,"로그인"))],8,ne)])],32)])])])])),l.success?(n(),a("p",ie,y(l.success),1)):S("",!0),l.error?(n(),a("p",ce,y(l.error),1)):S("",!0)]))}};export{me as default};
