import{l as w,r as b,B as E,u as I,o as R,c as a,a as s,k as q,m as _,d as G,t as f,q as P,p as d,v as c,C as H,D as O,i as n,E as $,G as z,H as J,I as K}from"./index-Tscrubo2.js";const Q={class:"panel"},W={key:0,class:"row g-4"},X={class:"col-12 col-lg-6"},Y={class:"card h-100 border-0"},Z={class:"card-body d-flex flex-column gap-3"},ss={class:"d-flex gap-3 align-items-center"},es=["src"],ts={class:"mb-1 text-light fw-semibold"},os={key:0},ls={class:"mb-1 text-white-50"},as={class:"mb-0 text-white-50"},ns={class:"col-12 col-lg-6"},rs={class:"card h-100 border-0"},is={class:"card-body"},ds={class:"col-12"},cs={class:"col-12"},us={class:"col-12"},ps=["disabled"],ms={key:0},vs={key:1},bs={class:"col-12 col-lg-6"},_s={class:"card border-0 h-100"},fs={class:"card-body d-flex flex-column gap-3"},hs=["disabled"],ys={key:0},ws={key:1},gs={class:"col-12 col-lg-6"},xs={class:"card border-0 h-100"},ks={class:"card-body"},Us={class:"col-12"},Vs={class:"col-12"},qs={class:"col-12"},Ps=["disabled"],Cs={key:0},Fs={key:1},Ss={key:1,class:"row g-4"},js={class:"col-12 col-lg-6"},As={class:"card border-0 h-100"},Ds={class:"card-body"},Bs={class:"col-12"},Ls={class:"col-12"},Ms={class:"col-12"},Ns={class:"col-12"},Ts={class:"col-12"},Es=["disabled"],Is={key:0},Rs={key:1},Gs={class:"col-12 col-lg-6"},Hs={class:"card border-0 h-100"},Os={class:"card-body"},$s={class:"col-12"},zs={class:"col-12"},Js={class:"col-12"},Ks=["disabled"],Qs={key:0},Ws={key:1},Xs={key:2,class:"mt-4 text-success text-center fw-semibold"},Ys={key:3,class:"mt-2 text-danger text-center fw-semibold"},ee={__name:"AccountsView",setup(Zs){const{profile:i,setSession:h,clearSession:S,ensureProfileLoaded:j}=I(),r=w({username:"",email:"",password:"",name:""}),u=w({username:"",password:""}),p=w({display_name:"",bio:""}),m=w({current_password:"",new_password:""}),y=b(null),l=w({success:"",error:""}),g=b(!1),x=b(!1),k=b(!1),U=b(!1),V=b(!1),F=E(()=>i.value?.avatar_url||""),v=()=>{l.success="",l.error=""},C=()=>{p.display_name=i.value?.display_name||"",p.bio=i.value?.bio||""},A=async()=>{v(),g.value=!0;try{const t=await J({username:r.username.trim(),email:r.email.trim(),password:r.password,name:r.name.trim()});h(t.token,t.profile),C(),r.username="",r.email="",r.password="",r.name="",l.success="회원가입이 완료되었습니다."}catch(t){l.error=t?.payload?.detail||"회원가입에 실패했습니다."}finally{g.value=!1}},D=async()=>{v(),x.value=!0;try{const t=await K({username:u.username.trim(),password:u.password});h(t.token,t.profile),C(),u.username="",u.password="",l.success="로그인이 완료되었습니다."}catch(t){l.error=t?.payload?.detail||"로그인에 실패했습니다."}finally{x.value=!1}},B=async()=>{v();try{await H()}catch(t){console.warn("로그아웃 요청 실패",t)}finally{S(),l.success="로그아웃되었습니다."}},L=async()=>{v(),k.value=!0;try{const t=await $({display_name:p.display_name,bio:p.bio});h(void 0,t.profile),l.success="프로필을 업데이트했습니다."}catch(t){l.error=t?.payload?.detail||"프로필을 수정하지 못했습니다."}finally{k.value=!1}},M=t=>{const[e]=t.target.files||[];y.value=e||null},N=async()=>{if(y.value){v(),V.value=!0;try{const t=new FormData;t.append("avatar",y.value);const e=await O(t);h(void 0,e.profile),y.value=null,l.success="아바타를 업데이트했습니다."}catch(t){l.error=t?.payload?.detail||"아바타 업로드에 실패했습니다."}finally{V.value=!1}}},T=async()=>{v(),U.value=!0;try{const t=await z({current_password:m.current_password,new_password:m.new_password});t?.token&&h(t.token,i.value),m.current_password="",m.new_password="",l.success="비밀번호가 변경되었습니다."}catch(t){l.error=t?.payload?.detail||(t?.payload&&typeof t.payload=="object"?Object.values(t.payload).flat().join(" "):"비밀번호를 변경하지 못했습니다.")}finally{U.value=!1}};return R(async()=>{await j(),i.value&&C()}),(t,e)=>(n(),a("section",Q,[e[26]||(e[26]=s("div",{class:"d-flex justify-content-between align-items-center mb-3"},[s("div",null,[s("h2",{class:"h4 text-light mb-1"},"계정 관리"),s("p",{class:"text-white-50 mb-0"},"Token 인증 기반으로 회원정보를 조회·수정합니다.")])],-1)),_(i)?(n(),a("div",W,[s("div",X,[s("div",Y,[s("div",Z,[s("div",{class:"d-flex justify-content-between align-items-center"},[e[10]||(e[10]=s("h5",{class:"text-light mb-0"},"내 계정",-1)),s("button",{class:"btn btn-outline-light btn-sm nav-hover",type:"button",onClick:B},"로그아웃")]),s("div",ss,[F.value?(n(),a("img",{key:0,src:F.value,alt:"avatar",class:"rounded-4 border border-secondary",width:"72",height:"72"},null,8,es)):q("",!0),s("div",null,[s("p",ts,[_(i).user.first_name?(n(),a("span",os,f(_(i).user.first_name)+" · ",1)):q("",!0),G("@"+f(_(i).user.username),1)]),s("p",ls,f(_(i).user.email||"이메일 정보 없음"),1),s("p",as,f(_(i).bio||"소개글이 없습니다."),1)])])])])]),s("div",ns,[s("div",rs,[s("div",is,[e[13]||(e[13]=s("h5",{class:"text-light mb-3"},"프로필 수정",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:P(L,["prevent"])},[s("div",ds,[e[11]||(e[11]=s("label",{class:"form-label text-white-50"},"표시 이름",-1)),d(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.display_name=o),class:"form-control",placeholder:"공개 이름"},null,512),[[c,p.display_name]])]),s("div",cs,[e[12]||(e[12]=s("label",{class:"form-label text-white-50"},"소개",-1)),d(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=o=>p.bio=o),class:"form-control",rows:"3",placeholder:"자기 소개를 입력해 주세요"},null,512),[[c,p.bio]])]),s("div",us,[s("button",{class:"btn btn-primary nav-hover",disabled:k.value,type:"submit"},[k.value?(n(),a("span",ms,"저장 중...")):(n(),a("span",vs,"프로필 저장"))],8,ps)])],32)])])]),s("div",bs,[s("div",_s,[s("div",fs,[e[14]||(e[14]=s("h5",{class:"text-light"},"아바타",-1)),s("input",{class:"form-control",type:"file",accept:"image/*",onChange:M},null,32),s("button",{class:"btn btn-outline-light nav-hover",disabled:V.value||!y.value,type:"button",onClick:N},[V.value?(n(),a("span",ys,"업로드 중...")):(n(),a("span",ws,"아바타 업로드"))],8,hs)])])]),s("div",gs,[s("div",xs,[s("div",ks,[e[17]||(e[17]=s("h5",{class:"text-light mb-3"},"비밀번호 변경",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:P(T,["prevent"])},[s("div",Us,[e[15]||(e[15]=s("label",{class:"form-label text-white-50"},"현재 비밀번호",-1)),d(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>m.current_password=o),class:"form-control",type:"password",required:""},null,512),[[c,m.current_password]])]),s("div",Vs,[e[16]||(e[16]=s("label",{class:"form-label text-white-50"},"새 비밀번호",-1)),d(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>m.new_password=o),class:"form-control",type:"password",minlength:"8",required:""},null,512),[[c,m.new_password]])]),s("div",qs,[s("button",{class:"btn btn-primary nav-hover",disabled:U.value,type:"submit"},[U.value?(n(),a("span",Cs,"변경 중...")):(n(),a("span",Fs,"비밀번호 변경"))],8,Ps)])],32)])])])])):(n(),a("div",Ss,[s("div",js,[s("div",As,[s("div",Ds,[e[22]||(e[22]=s("h5",{class:"text-light mb-3"},"회원가입",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:P(A,["prevent"])},[s("div",Bs,[e[18]||(e[18]=s("label",{class:"form-label text-white-50"},"아이디",-1)),d(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.username=o),class:"form-control",placeholder:"예) new_user",minlength:"3",required:""},null,512),[[c,r.username]])]),s("div",Ls,[e[19]||(e[19]=s("label",{class:"form-label text-white-50"},"이름",-1)),d(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.name=o),class:"form-control",placeholder:"한글 2~5글자",pattern:"^[가-힣]{2,5}$",required:""},null,512),[[c,r.name]])]),s("div",Ms,[e[20]||(e[20]=s("label",{class:"form-label text-white-50"},"이메일",-1)),d(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.email=o),class:"form-control",type:"email",placeholder:"you@example.com",required:""},null,512),[[c,r.email]])]),s("div",Ns,[e[21]||(e[21]=s("label",{class:"form-label text-white-50"},"비밀번호",-1)),d(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.password=o),class:"form-control",type:"password",placeholder:"8자 이상",minlength:"8",required:""},null,512),[[c,r.password]])]),s("div",Ts,[s("button",{class:"btn btn-primary nav-hover",disabled:g.value,type:"submit"},[g.value?(n(),a("span",Is,"가입 중...")):(n(),a("span",Rs,"회원가입"))],8,Es)])],32)])])]),s("div",Gs,[s("div",Hs,[s("div",Os,[e[25]||(e[25]=s("h5",{class:"text-light mb-3"},"로그인",-1)),s("form",{class:"row g-3",autocomplete:"off",onSubmit:P(D,["prevent"])},[s("div",$s,[e[23]||(e[23]=s("label",{class:"form-label text-white-50"},"아이디",-1)),d(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>u.username=o),class:"form-control",placeholder:"아이디를 입력하세요",required:""},null,512),[[c,u.username]])]),s("div",zs,[e[24]||(e[24]=s("label",{class:"form-label text-white-50"},"비밀번호",-1)),d(s("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>u.password=o),class:"form-control",type:"password",placeholder:"비밀번호를 입력하세요",required:""},null,512),[[c,u.password]])]),s("div",Js,[s("button",{class:"btn btn-outline-light nav-hover",disabled:x.value,type:"submit"},[x.value?(n(),a("span",Qs,"로그인 중...")):(n(),a("span",Ws,"로그인"))],8,Ks)])],32)])])])])),l.success?(n(),a("p",Xs,f(l.success),1)):q("",!0),l.error?(n(),a("p",Ys,f(l.error),1)):q("",!0)]))}};export{ee as default};
