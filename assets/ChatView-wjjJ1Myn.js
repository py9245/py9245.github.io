import{r as f,p as I,c as U,u as fe,L as z,o as pe,M as he,a as o,j as n,b as e,l as V,t as c,F as ne,g as ae,n as B,q as J,x as Z,s as L,z as le,v as W,N as Re,O as _e,P as ie,Q as ye,d as oe,w as ue,e as de,f as Ce,R as Le,S as Ae}from"./index-Ce9XECHM.js";const Ee={class:"card border-0"},Te={class:"card-body"},Ue={class:"d-flex flex-column flex-lg-row justify-content-between gap-3 mb-3"},Oe={class:"text-white-50 small mb-0"},Ne={class:"text-white-50 small mb-0"},je={class:"d-flex gap-2 align-items-start"},Pe=["disabled"],Ve={key:0},Be={key:1},We={key:0,class:"alert alert-danger"},Ie={key:1,class:"alert alert-success"},Me={key:0,class:"text-center text-white-50 my-5"},De={class:"d-flex justify-content-between align-items-center"},Fe={class:"mb-0 mt-1"},Je={key:2,class:"alert alert-warning mb-0"},Ke={key:3},qe={class:"alert alert-info mb-3"},He={key:0,class:"form-check form-switch mb-3"},Ge={class:"form-check-label text-white-50",for:"globalChatAnon"},Ye={key:1,class:"text-white-50 small"},ze={key:2,class:"alert alert-warning mt-2"},Qe=["disabled"],Xe={key:0},Ze={key:1},et="오픈 라운지",me=80,tt=4e3,st={__name:"GlobalChatPanel",setup(be){const{profile:p,ensureProfileLoaded:ee}=fe(),w=f(null),x=f([]),O=f(!1),A=f(!1),r=I({status:"idle",detail:"실시간 연결을 준비 중입니다."}),b=I({content:"",is_anonymous:!0}),u=I({error:"",info:"",form:""}),$=f(null),m=f(null);let R=null,N=!1;const d=U(()=>!!p.value?.user?.is_staff),h=U(()=>!!(p.value&&w.value&&b.content.trim())&&r.status==="open"),_=U(()=>{const l=p.value?.user;if(!l)return"";const i=l.email||"이메일 정보 없음";return`${l.username} 님으로 접속 중입니다. (${i})`}),M={idle:"실시간 연결을 준비 중입니다.",connecting:"실시간 연결을 준비 중입니다...",open:"실시간 연결됨 · 새 메시지가 자동으로 표시됩니다.",closed:"실시간 연결이 끊어졌습니다. 잠시 후 재시도합니다."},y=(l,i)=>{r.status=l,r.detail=i||M[l]||""},E=f((()=>{if(typeof window>"u")return null;const l=(window.location.hostname||"").toLowerCase(),i=l.includes("github.io")||l.includes("githubusercontent.com");let v=window.API_BASE_URL||void 0||"/api";i&&(v=window.API_BASE_URL||"https://3-37-130-181.nip.io/api");try{const C=new URL(v,window.location.origin);return`${C.protocol==="https:"?"wss:":"ws:"}//${C.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})()),j=()=>{Re(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})},k=()=>{if(N=!1,R&&(clearTimeout(R),R=null),m.value)try{m.value.close()}catch{}m.value=null,p.value?y("idle"):y("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")},Q=()=>{const l=ye();return!l||!w.value||!E.value?null:`${E.value}/ws/chatrooms/${w.value.id}/?token=${encodeURIComponent(l)}`},P=l=>{if(!m.value||m.value.readyState!==WebSocket.OPEN)return u.error="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해주세요.",y("connecting"),!1;try{return m.value.send(JSON.stringify(l)),!0}catch(i){return console.error("WebSocket 전송 오류",i),u.error="실시간 메시지를 전송하지 못했습니다.",!1}},D=()=>{u.error="",P({action:"fetch_history"})||(u.info="")},X=l=>{try{const i=JSON.parse(l.data);i.event==="history"?(x.value=Array.isArray(i.messages)?i.messages.slice(-me):[],j(),u.info=""):i.event==="message"?i.message&&(x.value=[...x.value,i.message].slice(-me),j()):i.event==="error"&&(u.error=i.detail||"실시간 채팅 오류가 발생했습니다.")}catch(i){console.error("WebSocket 메시지 파싱 실패",i)}},q=()=>{if(!p.value||!w.value){k();return}const l=Q();if(!l){u.error="실시간 연결 정보를 계산하지 못했습니다.";return}k(),N=!0,y("connecting"),m.value=new WebSocket(l),m.value.addEventListener("open",()=>{y("open"),u.info="실시간 연결이 완료되었습니다.",D()}),m.value.addEventListener("message",X),m.value.addEventListener("close",()=>{m.value=null,N&&p.value&&w.value?(y("closed"),R=window.setTimeout(()=>{R=null,q()},tt)):y("idle")}),m.value.addEventListener("error",i=>{console.error("WebSocket error",i),u.error="실시간 연결 중 문제가 발생했습니다."})},te=async()=>{const l=await _e(),i=Array.isArray(l?.rooms)?l.rooms:[];if(!i.length)throw new Error("입장 가능한 공개 채팅방이 없습니다.");let v=i.find(C=>C.name===et)||i.find(C=>!C.is_private)||i[0];if(!v)throw new Error("입장 가능한 공개 채팅방이 없습니다.");return v.is_member||(v=(await ie({name:v.name}))?.room||v),v},H=async()=>{if(!p.value){k();return}O.value=!0,u.error="",u.info="";try{const l=await te();w.value=l,x.value=[],q()}catch(l){console.error(l),w.value=null,u.error=l?.message||"채팅방 정보를 불러오지 못했습니다."}finally{O.value=!1}},T=()=>{if(u.form="",!p.value){u.form="로그인 후 이용해 주세요.";return}if(!w.value){u.form="입장 가능한 공개 채팅방이 없습니다.";return}const l=b.content.trim();if(!l){u.form="메시지를 입력해 주세요.";return}const i={action:"send_message",content:l,is_anonymous:d.value?!1:b.is_anonymous};A.value=!0,P(i)&&(b.content=""),A.value=!1},F=l=>{l.key!=="Enter"||l.shiftKey||l.isComposing||(l.preventDefault(),T())};return z(p,(l,i)=>{l?i||(b.is_anonymous=!d.value,H()):(b.content="",b.is_anonymous=!0,w.value=null,x.value=[],k(),y("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다."))},{immediate:!1}),z(d,l=>{l&&(b.is_anonymous=!1)},{immediate:!0}),z(x,j),pe(async()=>{await ee(),p.value?(b.is_anonymous=!d.value,await H()):y("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")}),he(()=>{k()}),(l,i)=>(n(),o("div",Ee,[e("div",Te,[e("div",Ue,[e("div",null,[i[2]||(i[2]=e("h5",{class:"text-light mb-1"},"실시간 자유 채팅",-1)),i[3]||(i[3]=e("p",{class:"text-white-50 mb-0"}," 누구나 참여할 수 있는 공개 채팅방입니다. 새 메시지는 실시간으로 표시됩니다. ",-1)),e("p",Oe,c(w.value?`${w.value.name} · 정원 ${w.value.member_count}/${w.value.capacity}`:"채팅방 준비 중"),1),e("p",Ne,c(r.detail),1)]),e("div",je,[e("button",{class:"btn btn-outline-info nav-hover",disabled:O.value,type:"button",onClick:H},[O.value?(n(),o("span",Ve,"준비 중...")):(n(),o("span",Be,"다시 연결"))],8,Pe),e("button",{class:"btn btn-outline-light nav-hover",type:"button",onClick:D},"즉시 새로고침")])]),u.error?(n(),o("div",We,c(u.error),1)):u.info?(n(),o("div",Ie,c(u.info),1)):V("",!0),e("div",{ref_key:"messageContainer",ref:$,class:"chat-messages list-group list-group-flush mb-3",style:{"max-height":"420px","overflow-y":"auto"}},[x.value.length?V("",!0):(n(),o("p",Me,"아직 대화가 없습니다. 첫 메시지를 남겨보세요!")),(n(!0),o(ne,null,ae(x.value,v=>(n(),o("article",{key:v.id,class:"list-group-item bg-transparent text-light"},[e("div",De,[e("span",{class:B(["fw-semibold",{"text-warning":v.is_anonymous}])},c(v.display_name||(v.is_anonymous?"익명":"사용자")),3),e("small",null,c(new Date(v.created_at).toLocaleString("ko-KR",{dateStyle:"short",timeStyle:"short"})),1)]),e("p",Fe,c(v.content),1)]))),128))],512),J(p)?(n(),o("div",Ke,[e("div",qe,c(_.value),1),e("form",{autocomplete:"off",onSubmit:Z(T,["prevent"])},[d.value?(n(),o("p",Ye,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(n(),o("div",He,[L(e("input",{id:"globalChatAnon","onUpdate:modelValue":i[0]||(i[0]=v=>b.is_anonymous=v),class:"form-check-input",type:"checkbox"},null,512),[[le,b.is_anonymous]]),e("label",Ge,c(b.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),L(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=v=>b.content=v),class:"form-control",placeholder:"지금 떠오르는 이야기를 적어보세요 (최대 500자)",maxlength:"500",rows:"4",onKeydown:F},null,544),[[W,b.content]]),u.form?(n(),o("div",ze,c(u.form),1)):V("",!0),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:A.value||!h.value,type:"submit"},[A.value?(n(),o("span",Xe,"전송 중...")):(n(),o("span",Ze,"메시지 전송"))],8,Qe)],32)])):(n(),o("div",Je," 로그인한 사용자만 자유 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])]))}},ot={class:"panel"},nt={class:"d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3 mb-4"},at={class:"d-flex align-items-center gap-2 mb-2"},lt={class:"d-flex flex-wrap gap-2"},it={class:"row g-3 mb-4"},rt={class:"col-12 col-lg-4"},ct={class:"soft-card h-100"},ut={class:"mb-1 text-light"},dt={class:"text-white-50 mb-0"},mt={class:"col-12 col-lg-4"},vt={class:"soft-card h-100"},ft={class:"d-flex align-items-center gap-2"},pt={class:"text-white-50"},ht={class:"col-12 col-lg-4"},_t={class:"soft-card h-100"},yt={class:"d-block mb-1 text-light"},bt={class:"text-white-50"},wt={class:"nav nav-pills gap-2 mb-4 flex-wrap"},gt={key:0},kt={key:1},xt={class:"row g-4"},$t={class:"col-12 col-lg-4"},St={class:"card border-0 mb-4"},Rt={class:"card-body"},Ct={key:0,class:"alert alert-info"},Lt={key:1,class:"alert alert-danger"},At={key:2,class:"d-flex flex-column gap-2 room-list"},Et={key:0,class:"panel-placeholder"},Tt={class:"mb-0 fw-semibold text-light"},Ut={class:"text-white-50"},Ot=["disabled","onClick"],Nt={key:0},jt={key:1},Pt={key:2},Vt={key:3},Bt={key:4},Wt={class:"card border-0 mb-4"},It={class:"card-body"},Mt={class:"col-12"},Dt={class:"col-12"},Ft={class:"col-12 form-check form-switch"},Jt={key:0,class:"col-12"},Kt={class:"col-12"},qt=["disabled"],Ht={key:0},Gt={key:1},Yt={class:"card border-0"},zt={class:"card-body"},Qt={class:"col-12"},Xt={class:"col-12"},Zt={class:"col-12"},es=["disabled"],ts={key:0},ss={key:1},os={class:"col-12 col-lg-8"},ns={class:"card border-0 h-100 chat-frame"},as={class:"card-body d-flex flex-column gap-3 h-100"},ls={class:"d-flex justify-content-between align-items-start flex-wrap gap-2"},is={class:"text-light mb-1"},rs={class:"text-white-50 mb-0"},cs={key:0,class:"text-white-50 small mb-0"},us={class:"d-flex gap-2"},ds=["disabled"],ms={key:0},vs={key:1},fs={key:0,class:"alert alert-info"},ps={key:1,class:"alert alert-secondary"},hs={key:2,class:"chat-messages list-group list-group-flush"},_s={class:"d-flex justify-content-between"},ys={class:"mt-1"},bs={key:3,class:"alert alert-warning"},ws={key:4,class:"alert alert-danger"},gs={key:5,class:"alert alert-warning"},ks={key:0,class:"form-check form-switch mb-3"},xs={class:"form-check-label text-white-50",for:"chatAnon"},$s={key:1,class:"text-white-50 small"},Ss=["disabled"],Rs={key:0},Cs={key:1},Ls={key:7,class:"alert alert-info mt-auto"},As={key:8,class:"alert alert-warning mt-auto"},ve=80,Ts={__name:"ChatView",setup(be){const{profile:p,ensureProfileLoaded:ee}=fe(),w=U(()=>!!p.value?.user?.is_staff),x=f([]),O=f(!1),A=f(""),r=f(null),b=f(null),u=f(!1),$=f([]),m=I({content:"",is_anonymous:!0}),R=f(!1),N=f(!1),d=f(""),h=I({status:"idle",error:""}),_=I({name:"",capacity:10,is_private:!1,password:""}),M=f(!1),y=I({name:"",password:""}),K=f(!1);let E=null,j=!1;const k=f(null),Q=U(()=>!w.value),P=f("global"),D=U(()=>{switch(h.status){case"open":return"실시간 연결됨";case"connecting":return"연결 준비 중";case"closed":return"재연결 대기";default:return"대기 중"}}),X=U(()=>h.status==="open"?"pill-success":h.status==="connecting"?"pill-warning":h.status==="closed"?"pill-danger":"pill-muted"),q=U(()=>r.value?`정원 ${r.value.member_count}/${r.value.capacity} · ${r.value.is_private?"비공개":"공개"}`:"입장 후 메시지를 보낼 수 있습니다."),te=s=>{if(!s)return"";const t=typeof s=="string"?new Date(s):s;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"short",timeStyle:"short"}).format(t)},H=U(()=>!!(p.value&&r.value&&m.content.trim())&&h.status==="open"),T=async()=>{O.value=!0,A.value="";try{const s=await _e();x.value=Array.isArray(s?.rooms)?s.rooms:[]}catch(s){console.error(s),A.value="채팅방 목록을 불러오지 못했습니다."}finally{O.value=!1}},F=s=>{r.value=s||null},i=(()=>{if(typeof window>"u")return null;const s=(window.location.hostname||"").toLowerCase(),t=s.includes("github.io")||s.includes("githubusercontent.com");let g=window.API_BASE_URL||void 0||"/api";t&&(g=window.API_BASE_URL||"https://3-37-130-181.nip.io/api");try{const a=new URL(g,window.location.origin);return`${a.protocol==="https:"?"wss:":"ws:"}//${a.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})(),v=s=>{const t=ye();return!t||!i?null:`${i}/ws/chatrooms/${s}/?token=${encodeURIComponent(t)}`},C=()=>{E&&(clearTimeout(E),E=null)},G=()=>{if(j=!1,C(),k.value)try{k.value.close()}catch{}k.value=null,r.value?h.status="closed":h.status="idle"},we=()=>{!j||E||(E=window.setTimeout(()=>{E=null,r.value&&se(r.value.id)},3e3))},se=s=>{if(G(),!s)return;const t=v(s);if(!t){d.value="로그인 후 이용해 주세요.";return}j=!0,h.status="connecting",h.error="",R.value=!0;const g=new WebSocket(t);k.value=g,g.addEventListener("open",()=>{h.status="open",h.error="",g.send(JSON.stringify({action:"fetch_history"}))}),g.addEventListener("message",a=>{try{const S=JSON.parse(a.data);if(S.event==="history")$.value=Array.isArray(S.messages)?S.messages.slice(-ve):[],R.value=!1;else if(S.event==="message"){const ce=S.message;ce&&($.value=[...$.value,ce].slice(-ve))}else S.event==="error"&&(d.value=S.detail||"실시간 채팅 오류가 발생했습니다.")}catch(S){console.error("WebSocket message parse error",S)}}),g.addEventListener("close",()=>{k.value=null,j&&r.value?(h.status="closed",we()):h.status=r.value?"closed":"idle"}),g.addEventListener("error",a=>{console.error("WebSocket error",a),h.error="실시간 연결에 문제가 발생했습니다."})};z(w,s=>{s&&(m.is_anonymous=!1)},{immediate:!0}),z(r,s=>{$.value=[],d.value="",s?se(s.id):(G(),R.value=!1)});const Y=()=>p.value?!0:(d.value="로그인 후 이용해 주세요.",!1),ge=async s=>{if(Y()){b.value=s.id,d.value="";try{const t=await ie({name:s.name});F(t?.room??null),s.is_private||await T()}catch(t){console.error(t),d.value=t?.payload?.detail||"채팅방에 입장하지 못했습니다."}finally{b.value=null}}},ke=async()=>{if(Y()){if(!y.name.trim()){d.value="비공개 채팅방 이름을 입력해주세요.";return}if(!y.password.trim()){d.value="비공개 채팅방 비밀번호를 입력해주세요.";return}K.value=!0,d.value="";try{const s=await ie({name:y.name.trim(),password:y.password});F(s?.room??null),y.name="",y.password=""}catch(s){console.error(s),d.value=s?.payload?.detail||"비공개 채팅방에 입장하지 못했습니다."}finally{K.value=!1}}},xe=async()=>{if(Y()){M.value=!0,d.value="";try{const s=await Ae({name:_.name.trim(),capacity:Number(_.capacity),is_private:_.is_private,password:_.is_private?_.password:""});if(!s?.room)throw new Error("채팅방 응답이 없습니다.");F(s.room),s.room.is_private||await T(),_.name="",_.password="",_.capacity=10,_.is_private=!1}catch(s){console.error(s),d.value=s?.payload?.detail||(s?.payload&&typeof s.payload=="object"?Object.values(s.payload).flat().join(" "):"채팅방을 생성하지 못했습니다.")}finally{M.value=!1}}},$e=async()=>{if(!(!r.value||!Y())){u.value=!0,d.value="";try{await Le(r.value.id),G(),F(null),await T()}catch(s){console.error(s),d.value=s?.payload?.detail||"채팅방에서 나가지 못했습니다."}finally{u.value=!1}}},re=()=>{if(!Y())return;if(!r.value){d.value="먼저 채팅방에 입장해 주세요.";return}if(h.status!=="open"||!k.value){d.value="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해 주세요.",r.value&&se(r.value.id);return}const s=m.content.trim();if(!s){d.value="메시지를 입력해 주세요.";return}N.value=!0;const t={action:"send_message",content:s,is_anonymous:Q.value?m.is_anonymous:!1};try{k.value.send(JSON.stringify(t)),m.content="",d.value=""}catch(g){console.error(g),d.value="메시지를 전송하지 못했습니다."}finally{N.value=!1}},Se=s=>{s.key!=="Enter"||s.shiftKey||s.isComposing||(s.preventDefault(),re())};return pe(async()=>{await ee(),await T()}),he(()=>{G()}),(s,t)=>{const g=Ce("router-link");return n(),o("section",ot,[e("div",nt,[e("div",null,[e("div",at,[t[10]||(t[10]=e("span",{class:"pill pill-muted"},"오픈 채팅",-1)),e("span",{class:B(["pill",X.value])},c(D.value),3)]),t[11]||(t[11]=e("h2",{class:"h4 text-light mb-1"},"누구나 참여하는 오픈 라운지",-1)),t[12]||(t[12]=e("p",{class:"text-white-50 mb-0"}," 원하는 방을 선택해 바로 대화하거나, 새 방을 만들어 초대 코드를 공유하세요. ",-1))]),e("div",lt,[oe(g,{class:"btn btn-outline-light nav-hover",to:"/"},{default:ue(()=>[...t[13]||(t[13]=[de("메인으로",-1)])]),_:1}),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:T},"목록 새로고침")])]),e("div",it,[e("div",rt,[e("div",ct,[t[14]||(t[14]=e("p",{class:"text-white-50 small mb-1"},"내 상태",-1)),e("h6",ut,c(J(p)?J(p).user.username:"로그인 필요"),1),e("p",dt,c(J(p)?Q.value?"익명/닉네임 선택 가능":"관리자 · 실명 발송":"로그인 후 참여 가능"),1)])]),e("div",mt,[e("div",vt,[t[15]||(t[15]=e("p",{class:"text-white-50 small mb-1"},"실시간 연결",-1)),e("div",ft,[e("span",{class:B(["pill",X.value])},c(D.value),3),e("small",pt,c(h.error||"끊기면 자동으로 다시 연결합니다."),1)])])]),e("div",ht,[e("div",_t,[t[16]||(t[16]=e("p",{class:"text-white-50 small mb-1"},"현재 방",-1)),e("strong",yt,c(r.value?r.value.name:"아직 선택되지 않음"),1),e("small",bt,c(q.value),1)])])]),e("div",wt,[e("button",{class:B(["btn nav-hover",P.value==="global"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[0]||(t[0]=a=>P.value="global")}," 실시간 자유 채팅 ",2),e("button",{class:B(["btn nav-hover",P.value==="rooms"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[1]||(t[1]=a=>P.value="rooms")}," 채팅방 관리 ",2)]),P.value==="global"?(n(),o("div",gt,[oe(st)])):(n(),o("div",kt,[t[29]||(t[29]=e("div",{class:"alert alert-info mb-4"}," 원하는 분위기의 방이 없다면 직접 만들고 링크를 공유하세요. 비공개 방은 목록에 표시되지 않고 비밀번호로만 입장합니다. ",-1)),e("div",xt,[e("div",$t,[e("div",St,[e("div",Rt,[e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t[17]||(t[17]=e("h5",{class:"text-light mb-0"},"공개 채팅방",-1)),e("button",{class:"btn btn-sm btn-outline-info nav-hover",type:"button",onClick:T},"새로고침")]),t[18]||(t[18]=e("p",{class:"text-white-50 small mb-3"},"목록에는 누구나 입장 가능한 공개형 채팅방만 표시됩니다.",-1)),O.value?(n(),o("div",Ct,"채팅방 목록을 불러오는 중...")):A.value?(n(),o("div",Lt,c(A.value),1)):(n(),o("div",At,[x.value.length?V("",!0):(n(),o("div",Et,"아직 공개 채팅방이 없습니다.")),(n(!0),o(ne,null,ae(x.value,a=>(n(),o("article",{key:a.id,class:"room-tile d-flex justify-content-between align-items-center"},[e("div",null,[e("p",Tt,c(a.name),1),e("small",Ut,c(a.member_count)+"/"+c(a.capacity)+" · "+c(a.owner_username||"운영자"),1)]),e("button",{class:B(["btn btn-sm nav-hover",a.is_member?"btn-secondary":"btn-outline-light"]),disabled:b.value===a.id||a.member_count>=a.capacity||a.is_member&&r.value&&r.value.id===a.id,type:"button",onClick:S=>ge(a)},[b.value===a.id?(n(),o("span",Nt,"입장 중...")):a.is_member&&r.value&&r.value.id===a.id?(n(),o("span",jt,"이용 중")):a.is_member?(n(),o("span",Pt,"입장 완료")):a.member_count>=a.capacity?(n(),o("span",Vt,"정원 초과")):(n(),o("span",Bt,"입장"))],10,Ot)]))),128))]))])]),e("div",Wt,[e("div",It,[t[24]||(t[24]=e("h5",{class:"text-light mb-3"},"채팅방 생성",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Z(xe,["prevent"])},[e("div",Mt,[t[19]||(t[19]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),L(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>_.name=a),class:"form-control",maxlength:"50",placeholder:"예) 주말 영화 추천방",required:""},null,512),[[W,_.name]])]),e("div",Dt,[t[20]||(t[20]=e("label",{class:"form-label text-white-50"},"정원 (2~200명)",-1)),L(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>_.capacity=a),class:"form-control",min:"2",max:"200",type:"number",required:""},null,512),[[W,_.capacity,void 0,{number:!0}]])]),e("div",Ft,[L(e("input",{id:"createPrivate","onUpdate:modelValue":t[4]||(t[4]=a=>_.is_private=a),class:"form-check-input",type:"checkbox"},null,512),[[le,_.is_private]]),t[21]||(t[21]=e("label",{class:"form-check-label text-white-50",for:"createPrivate"},"비공개 채팅방",-1))]),_.is_private?(n(),o("div",Jt,[t[22]||(t[22]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),L(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>_.password=a),class:"form-control",type:"password",minlength:"4",required:""},null,512),[[W,_.password]]),t[23]||(t[23]=e("small",{class:"text-white-50"},"목록에 표시되지 않으며 비밀번호로만 입장합니다.",-1))])):V("",!0),e("div",Kt,[e("button",{class:"btn btn-primary nav-hover w-100",disabled:M.value,type:"submit"},[M.value?(n(),o("span",Ht,"생성 중...")):(n(),o("span",Gt,"채팅방 생성"))],8,qt)])],32)])]),e("div",Yt,[e("div",zt,[t[27]||(t[27]=e("h5",{class:"text-light mb-3"},"비공개 채팅방 입장",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Z(ke,["prevent"])},[e("div",Qt,[t[25]||(t[25]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),L(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>y.name=a),class:"form-control",placeholder:"예) 프로젝트 A",required:""},null,512),[[W,y.name]])]),e("div",Xt,[t[26]||(t[26]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),L(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>y.password=a),class:"form-control",type:"password",required:""},null,512),[[W,y.password]])]),e("div",Zt,[e("button",{class:"btn btn-outline-light nav-hover w-100",disabled:K.value,type:"submit"},[K.value?(n(),o("span",ts,"입장 중...")):(n(),o("span",ss,"입장하기"))],8,es)])],32)])])]),e("div",os,[e("div",ns,[e("div",as,[e("div",ls,[e("div",null,[e("h5",is,c(r.value?r.value.name:"채팅방을 선택해 주세요"),1),e("p",rs,c(r.value?q.value:"좌측에서 채팅방을 선택하거나 새로 만들 수 있습니다."),1),r.value?(n(),o("p",cs,c(D.value)+" · 끊기면 자동으로 재연결합니다. ",1)):V("",!0)]),e("div",us,[oe(g,{class:"btn btn-outline-light btn-sm nav-hover",to:"/boards"},{default:ue(()=>[...t[28]||(t[28]=[de("게시판 보기",-1)])]),_:1}),r.value?(n(),o("button",{key:0,class:"btn btn-outline-danger btn-sm nav-hover",disabled:u.value,type:"button",onClick:$e},[u.value?(n(),o("span",ms,"나가는 중...")):(n(),o("span",vs,"채팅방 나가기"))],8,ds)):V("",!0)])]),R.value?(n(),o("div",fs,"채팅 메시지를 불러오는 중...")):r.value&&!$.value.length?(n(),o("div",ps," 아직 대화가 없습니다. 첫 메시지를 남겨보세요! ")):r.value?(n(),o("div",hs,[(n(!0),o(ne,null,ae($.value,a=>(n(),o("article",{key:a.id,class:"chat-message list-group-item"},[e("div",_s,[e("span",{class:B(["fw-semibold",{"text-warning":a.is_anonymous}])},c(a.display_name),3),e("small",null,c(te(a.created_at)),1)]),e("p",ys,c(a.content),1)]))),128))])):(n(),o("div",bs,"채팅방을 선택하거나 새로 만들어주세요.")),d.value?(n(),o("div",ws,c(d.value),1)):h.error?(n(),o("div",gs,c(h.error),1)):V("",!0),J(p)&&r.value?(n(),o("form",{key:6,class:"chat-form mt-auto",autocomplete:"off",onSubmit:Z(re,["prevent"])},[w.value?(n(),o("p",$s,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(n(),o("div",ks,[L(e("input",{id:"chatAnon","onUpdate:modelValue":t[8]||(t[8]=a=>m.is_anonymous=a),class:"form-check-input",type:"checkbox"},null,512),[[le,m.is_anonymous]]),e("label",xs,c(m.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),L(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=a=>m.content=a),class:"form-control",name:"chat-content",placeholder:"지금 떠오르는 생각을 적어보세요 (최대 500자)",maxlength:"500",onKeydown:Se},null,544),[[W,m.content]]),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:N.value||!H.value,type:"submit"},[N.value?(n(),o("span",Rs,"전송 중...")):(n(),o("span",Cs,"메시지 전송"))],8,Ss)],32)):J(p)?(n(),o("div",Ls," 채팅방에 입장해야 메시지를 보낼 수 있습니다. ")):(n(),o("div",As," 로그인한 사용자만 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])])])])]))])}}};export{Ts as default};
