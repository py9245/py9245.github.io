import{r as u,w as I,o as $,u as G,a as W,c as i,b as e,n as h,t as o,d as j,e as S,f as v,g as X,h as _,i as B,F as R,j as L,k as Y,l as Z,v as ee,m as se,p as te,q as ae,s as le,x as oe,y as ne,z as n,A as ie,B as re,C as ue}from"./index-DnedYGLe.js";const de={class:"panel mb-4 animate-[float_8s_ease-in-out_infinite]"},ce={class:"d-flex flex-column flex-lg-row justify-content-between gap-4"},ve={class:"d-inline-flex align-items-center gap-2 mb-3 text-uppercase small fw-semibold"},me={class:"d-flex flex-wrap gap-3"},he={class:"mini-stats row row-cols-1 g-3"},_e={class:"col"},pe={class:"card border-0 h-100 text-center py-3"},be={class:"text-light mb-0"},fe={class:"col"},ge={class:"card border-0 h-100 text-center py-3"},ye={class:"text-light mb-0"},xe={class:"col"},we={class:"card border-0 h-100 text-center py-3"},ke={class:"text-light mb-0"},Re={class:"panel random-chat-panel mb-4"},qe={class:"random-chat-header"},Ae={class:"random-chat-tabs"},Ce=["disabled"],Pe=["disabled"],Me={class:"random-status-row"},Se={class:"status-pill"},Be={class:"status-pill"},Le={class:"status-pill"},Te={key:0,class:"alert alert-danger random-alert"},De={key:1,class:"alert alert-warning random-alert"},Ne={key:0,class:"random-stream"},Ve={key:1,class:"random-placeholder"},ze=["disabled"],Ie={key:0},je={key:1},Ee={class:"panel mb-4"},Oe={key:0,class:"alert alert-danger"},Qe={key:1,class:"panel-placeholder"},He={key:2,class:"row g-4"},Fe={class:"card h-100 border-0 fade-card"},Je={class:"card-body d-flex flex-column gap-2"},Ke={class:"badge bg-secondary text-uppercase w-auto"},Ue={class:"card-title text-light mb-0"},$e={class:"card-text text-white-50 flex-grow-1"},Ge={class:"panel"},We={key:0,class:"row g-3"},Xe={class:"card border-0 h-100 mini-stat-card"},Ye={class:"card-body"},Ze={class:"text-white-50 mb-1"},es={class:"text-light mb-2"},ss={class:"text-white-50"},ts={class:"mb-0 text-white-50"},as={key:1,class:"panel-placeholder"},ls=2e3,is={__name:"HomeView",setup(os){const q=u({ok:null,text:"API 상태 확인 중..."}),T=u([]),A=u([]),p=u({users:0,posts:0,messages:0}),C=u(!0),b=u(""),{profile:d,ensureProfileLoaded:E}=G(),l=u({in_queue:!1,queue_position:null,queue_size:0,session:null,messages:[]}),P=u("idle"),r=u(""),f=u(!1),g=u(!1),y=u(!1),m=u(!1),c=u(""),O=/010-\d{4}-\d{4}/;let x=null;const w=(s={})=>{l.value={in_queue:!!s?.in_queue,queue_position:s?.queue_position??null,queue_size:s?.queue_size??0,session:s?.session||null,messages:Array.isArray(s?.messages)?s.messages:[]}},D=async()=>{C.value=!0,b.value="";try{const[s,t]=await Promise.all([se(),te()]);q.value={ok:!!s?.ok,text:s?.ok?"API 정상 동작 중":"API 응답 이상"},T.value=Array.isArray(t?.sections)?t.sections:[],A.value=Array.isArray(t?.stats)?t.stats:[],p.value=t?.totals??{users:0,posts:0,messages:0}}catch(s){console.error(s),b.value="메인 데이터를 불러오지 못했습니다."}finally{C.value=!1}},N=()=>d.value?(r.value="",!0):(r.value="랜덤 채팅은 로그인 후 이용할 수 있습니다.",!1),V=async()=>{if(d.value){f.value=!0,r.value="";try{const s=await ne({limit:60});w(s)}catch(s){console.error(s),r.value=s?.payload?.detail||"랜덤 채팅 상태를 불러오지 못했습니다."}finally{f.value=!1}}},z=async s=>{P.value=s,s==="queue"?await Q():s==="match"&&await F()},Q=async()=>{if(N()&&!g.value){g.value=!0,r.value="";try{const s=await le();w(s)}catch(s){console.error(s),r.value=s?.payload?.detail||"대기열에 들어가지 못했습니다."}finally{g.value=!1}}},H=async()=>{if(d.value){r.value="";try{await ae(),await V()}catch(s){console.error(s),r.value=s?.payload?.detail||"대기열에서 나갈 수 없습니다."}}},F=async()=>{if(N()&&!y.value){y.value=!0,r.value="";try{const s=await oe();w(s),c.value=""}catch(s){console.error(s),r.value=s?.payload?.detail||(s.status===401?"랜덤 채팅은 로그인 후 이용 가능합니다.":"랜덤 매칭에 실패했습니다.")}finally{y.value=!1}}},J=async()=>{if(!(!d.value||!l.value.session))try{const s=await ue({limit:60});Array.isArray(s?.messages)&&(l.value={...l.value,messages:s.messages})}catch(s){console.error(s)}},K=async()=>{if(!d.value||!l.value.session){r.value="매칭 후 메시지를 보낼 수 있습니다.";return}const s=c.value.trim();if(!s){r.value="메시지를 입력해 주세요.";return}if(O.test(s)){r.value="전화번호 형식(010-0000-0000)은 전송할 수 없습니다.";return}if(!m.value){m.value=!0,r.value="";try{const t=await re({content:s});l.value={...l.value,messages:[...l.value.messages,t]},c.value=""}catch(t){console.error(t),r.value=t?.payload?.detail||"메시지를 보내지 못했습니다."}finally{m.value=!1}}},U=()=>{k(),l.value.session&&(x=window.setInterval(()=>{J()},ls))},k=()=>{x&&(clearInterval(x),x=null)};return I(()=>l.value.session?.id,(s,t)=>{s!==t&&U(),s||k()}),I(()=>d.value,s=>{s?V():(k(),w({}),c.value="")},{immediate:!0}),$(async()=>{await E(),D()}),W(()=>{k()}),(s,t)=>{const M=X("router-link");return n(),i(R,null,[e("section",de,[e("div",ce,[e("div",null,[e("div",ve,[e("span",{class:h(["badge",q.value.ok?"bg-success":"bg-danger"])},null,2),e("span",null,o(q.value.text),1)]),t[5]||(t[5]=e("h1",{class:"display-5 fw-semibold text-light mb-3"},"Board · Account · Chat",-1)),t[6]||(t[6]=e("p",{class:"text-white-50 mb-4"}," Docker · Django · Postgres · Vue 스택을 한 화면에서 모니터링하고 제어할 수 있습니다. ",-1)),e("div",me,[j(M,{class:"btn btn-primary btn-lg shadow nav-hover",to:"/boards"},{default:S(()=>[...t[3]||(t[3]=[v("게시판 보기",-1)])]),_:1}),j(M,{class:"btn btn-outline-light btn-lg nav-hover",to:"/chat"},{default:S(()=>[...t[4]||(t[4]=[v("채팅방 열기",-1)])]),_:1})])]),e("div",he,[e("div",_e,[e("div",pe,[t[7]||(t[7]=e("p",{class:"text-white-50 mb-1"},"총 게시글",-1)),e("h2",be,o(p.value.posts),1)])]),e("div",fe,[e("div",ge,[t[8]||(t[8]=e("p",{class:"text-white-50 mb-1"},"채팅 메시지",-1)),e("h2",ye,o(p.value.messages),1)])]),e("div",xe,[e("div",we,[t[9]||(t[9]=e("p",{class:"text-white-50 mb-1"},"계정 수",-1)),e("h2",ke,o(p.value.users),1)])])])])]),e("section",Re,[e("div",qe,[t[10]||(t[10]=e("div",null,[e("span",{class:"random-chip"},"랜덤 채팅"),e("h2",{class:"random-title"},"한 번의 탭으로 익명 1:1 매칭"),e("p",{class:"random-subtitle"},[v(" 랜덤채팅 탭을 누르면 대기열에 합류하고, "),e("strong",null,"채팅하기"),v("를 누르면 본인을 제외한 다른 이용자와 즉시 연결됩니다. 모든 대화는 익명으로만 진행됩니다. ")])],-1)),e("div",Ae,[e("button",{class:h(["random-chat-tab",{active:P.value==="queue"}]),disabled:g.value||f.value,type:"button",onClick:t[0]||(t[0]=a=>z("queue"))}," 랜덤채팅 탭 ",10,Ce),e("button",{class:h(["random-chat-tab",{active:P.value==="match"}]),disabled:y.value||f.value,type:"button",onClick:t[1]||(t[1]=a=>z("match"))}," 채팅하기 ",10,Pe)])]),e("div",Me,[e("div",Se,[t[11]||(t[11]=e("span",{class:"label"},"대기열",-1)),e("strong",null,o(l.value.queue_size)+"명",1)]),e("div",Be,[t[12]||(t[12]=e("span",{class:"label"},"내 순서",-1)),e("strong",null,o(l.value.queue_position??"-"),1)]),e("div",Le,[t[13]||(t[13]=e("span",{class:"label"},"현재 상태",-1)),e("strong",null,o(l.value.session?l.value.session.partner_alias+" 연결됨":l.value.in_queue?"대기 중":"탭을 눌러 시작하세요"),1)]),l.value.in_queue?(n(),i("button",{key:0,class:"btn btn-outline-light nav-hover ms-auto random-leave-btn",type:"button",onClick:H}," 대기열 나가기 ")):_("",!0)]),r.value?(n(),i("div",Te,o(r.value),1)):_("",!0),B(d)?_("",!0):(n(),i("div",De," 로그인한 사용자만 랜덤 채팅에 참여할 수 있습니다. 계정 탭에서 로그인해 주세요. ")),e("div",{class:h(["random-chat-body",{disabled:!B(d)}])},[l.value.session&&l.value.messages.length?(n(),i("div",Ne,[(n(!0),i(R,null,L(l.value.messages,a=>(n(),i("article",{key:a.id,class:h(["random-chat-message",{me:a.from_self}])},[e("small",null,o(a.from_self?"나":l.value.session.partner_alias),1),e("p",null,o(a.content),1),e("time",null,o(new Date(a.created_at).toLocaleTimeString("ko-KR")),1)],2))),128))])):(n(),i("div",Ve,o(l.value.session?"아직 대화가 없습니다. 첫 메시지를 보내보세요!":"대기열에 합류하고 채팅하기를 누르면 새로운 익명 채팅방이 열립니다."),1)),B(d)&&l.value.session?(n(),i("form",{key:2,class:"random-chat-form",autocomplete:"off",onSubmit:Y(K,["prevent"])},[Z(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>c.value=a),class:"form-control",maxlength:"500",placeholder:"010-0000-0000 형식의 연락처는 전송이 제한됩니다."},null,512),[[ee,c.value]]),e("button",{class:"btn btn-light nav-hover",disabled:m.value||!c.value.trim(),type:"submit"},[m.value?(n(),i("span",Ie,"전송 중...")):(n(),i("span",je,"메시지 전송"))],8,ze)],32)):_("",!0)],2)]),e("section",Ee,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t[14]||(t[14]=e("div",null,[e("h2",{class:"h4 text-light mb-1"},"애플리케이션 개요"),e("p",{class:"text-white-50 mb-0"},"각 영역은 독립 라우트/앱으로 나뉘어 있습니다.")],-1)),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:D},"새로 고침")]),b.value?(n(),i("div",Oe,o(b.value),1)):C.value?(n(),i("div",Qe,"데이터를 불러오는 중...")):(n(),i("div",He,[(n(!0),i(R,null,L(T.value,a=>(n(),i("div",{key:a.id,class:"col-12 col-md-6 col-xl-3"},[e("div",Fe,[e("div",Je,[e("span",Ke,o(a.slug),1),e("h5",Ue,o(a.title),1),e("p",$e,o(a.description),1),a.cta_link?(n(),ie(M,{key:0,class:"btn btn-sm btn-outline-light align-self-start nav-hover",to:a.cta_link},{default:S(()=>[v(o(a.cta_label||"바로가기"),1)]),_:2},1032,["to"])):_("",!0)])])]))),128))]))]),e("section",Ge,[t[15]||(t[15]=e("div",{class:"mb-3"},[e("h2",{class:"h4 text-light mb-1"},"운영 수치"),e("p",{class:"text-white-50 mb-0"},"DB, 백엔드, 프런트엔드가 공유하는 제약 조건입니다.")],-1)),A.value.length?(n(),i("div",We,[(n(!0),i(R,null,L(A.value,a=>(n(),i("div",{key:a.id,class:"col-12 col-md-6 col-xl-4"},[e("div",Xe,[e("div",Ye,[e("p",Ze,o(a.name),1),e("h3",es,[v(o(a.value)+" ",1),e("small",ss,o(a.unit),1)]),e("p",ts,o(a.description),1)])])]))),128))])):(n(),i("p",as,"등록된 지표가 없습니다."))])],64)}}};export{is as default};
