import{l as h,r as f,B as E,u as I,o as R,c as l,a as s,k as P,m as _,d as G,t as v,q as C,p as i,v as d,C as H,D as O,i as n,E as $,G as z,H as J,I as K}from"./index-CzaoE9JK.js";const Q={class:"panel"},W={key:0,class:"authed-grid"},X={class:"authed-card"},Y={class:"authed-profile"},Z=["src"],ss={class:"authed-name"},es={key:0},as={class:"authed-email"},ts={class:"authed-bio"},os={class:"authed-card"},ls={class:"input-group"},ns={class:"input-group"},rs=["disabled"],us={key:0},is={key:1},ds={class:"authed-card"},ps=["disabled"],ms={key:0},cs={key:1},ys={class:"authed-card"},fs={class:"input-group"},_s={class:"input-group"},vs=["disabled"],bs={key:0},ws={key:1},hs={key:1,class:"auth-grid"},gs={class:"input-group"},ks={class:"input-group"},Us={class:"input-group"},Vs={class:"input-group"},qs=["disabled"],Ps={key:0},Cs={key:1},Fs={class:"input-group"},Ss={class:"input-group"},xs=["disabled"],Ds={key:0},As={key:1},js={key:2,class:"auth-message success"},Bs={key:3,class:"auth-message error"},Ns={__name:"AccountsView",setup(Ls){const{profile:u,setSession:b,clearSession:x,ensureProfileLoaded:D}=I(),r=h({username:"",email:"",password:"",name:""}),p=h({username:"",password:""}),m=h({display_name:"",bio:""}),c=h({current_password:"",new_password:""}),w=f(null),o=h({success:"",error:""}),g=f(!1),k=f(!1),U=f(!1),V=f(!1),q=f(!1),S=E(()=>u.value?.avatar_url||""),y=()=>{o.success="",o.error=""},F=()=>{m.display_name=u.value?.display_name||"",m.bio=u.value?.bio||""},A=async()=>{y(),g.value=!0;try{const a=await J({username:r.username.trim(),email:r.email.trim(),password:r.password,name:r.name.trim()});b(a.token,a.profile),F(),r.username="",r.email="",r.password="",r.name="",o.success="회원가입이 완료되었습니다."}catch(a){o.error=a?.payload?.detail||"회원가입에 실패했습니다."}finally{g.value=!1}},j=async()=>{y(),k.value=!0;try{const a=await K({username:p.username.trim(),password:p.password});b(a.token,a.profile),F(),p.username="",p.password="",o.success="로그인이 완료되었습니다."}catch(a){o.error=a?.payload?.detail||"로그인에 실패했습니다."}finally{k.value=!1}},B=async()=>{y();try{await H()}catch(a){console.warn("로그아웃 요청 실패",a)}finally{x(),o.success="로그아웃되었습니다."}},L=async()=>{y(),U.value=!0;try{const a=await $({display_name:m.display_name,bio:m.bio});b(void 0,a.profile),o.success="프로필을 업데이트했습니다."}catch(a){o.error=a?.payload?.detail||"프로필을 수정하지 못했습니다."}finally{U.value=!1}},M=a=>{const[e]=a.target.files||[];w.value=e||null},N=async()=>{if(w.value){y(),q.value=!0;try{const a=new FormData;a.append("avatar",w.value);const e=await O(a);b(void 0,e.profile),w.value=null,o.success="아바타를 업데이트했습니다."}catch(a){o.error=a?.payload?.detail||"아바타 업로드에 실패했습니다."}finally{q.value=!1}}},T=async()=>{y(),V.value=!0;try{const a=await z({current_password:c.current_password,new_password:c.new_password});a?.token&&b(a.token,u.value),c.current_password="",c.new_password="",o.success="비밀번호가 변경되었습니다."}catch(a){o.error=a?.payload?.detail||(a?.payload&&typeof a.payload=="object"?Object.values(a.payload).flat().join(" "):"비밀번호를 변경하지 못했습니다.")}finally{V.value=!1}};return R(async()=>{await D(),u.value&&F()}),(a,e)=>(n(),l("section",Q,[e[26]||(e[26]=s("header",{class:"panel-header"},[s("div",null,[s("h2",null,"계정 관리"),s("p",null,"Django Token 인증 기반으로 회원정보를 조회·수정합니다.")])],-1)),_(u)?(n(),l("div",W,[s("article",X,[s("header",null,[e[10]||(e[10]=s("h3",null,"내 계정",-1)),s("button",{class:"ghost-btn",type:"button",onClick:B},"로그아웃")]),s("div",Y,[S.value?(n(),l("img",{key:0,src:S.value,alt:"avatar"},null,8,Z)):P("",!0),s("div",null,[s("p",ss,[_(u).user.first_name?(n(),l("span",es,v(_(u).user.first_name)+" · ",1)):P("",!0),G("@"+v(_(u).user.username),1)]),s("p",as,v(_(u).user.email||"이메일 정보 없음"),1),s("p",ts,v(_(u).bio||"소개글이 없습니다."),1)])])]),s("article",os,[e[13]||(e[13]=s("h3",null,"프로필 수정",-1)),s("form",{class:"auth-form",autocomplete:"off",onSubmit:C(L,["prevent"])},[s("label",ls,[e[11]||(e[11]=s("span",null,"표시 이름",-1)),i(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>m.display_name=t),placeholder:"공개 이름"},null,512),[[d,m.display_name]])]),s("label",ns,[e[12]||(e[12]=s("span",null,"소개",-1)),i(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>m.bio=t),rows:"3",placeholder:"자기 소개를 입력해 주세요"},null,512),[[d,m.bio]])]),s("button",{class:"primary-btn",disabled:U.value,type:"submit"},[U.value?(n(),l("span",us,"저장 중...")):(n(),l("span",is,"프로필 저장"))],8,rs)],32)]),s("article",ds,[e[14]||(e[14]=s("h3",null,"아바타",-1)),s("input",{type:"file",accept:"image/*",onChange:M},null,32),s("button",{class:"ghost-btn",disabled:q.value||!w.value,type:"button",onClick:N},[q.value?(n(),l("span",ms,"업로드 중...")):(n(),l("span",cs,"아바타 업로드"))],8,ps)]),s("article",ys,[e[17]||(e[17]=s("h3",null,"비밀번호 변경",-1)),s("form",{class:"auth-form",autocomplete:"off",onSubmit:C(T,["prevent"])},[s("label",fs,[e[15]||(e[15]=s("span",null,"현재 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>c.current_password=t),type:"password",required:""},null,512),[[d,c.current_password]])]),s("label",_s,[e[16]||(e[16]=s("span",null,"새 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>c.new_password=t),type:"password",minlength:"8",required:""},null,512),[[d,c.new_password]])]),s("button",{class:"primary-btn",disabled:V.value,type:"submit"},[V.value?(n(),l("span",bs,"변경 중...")):(n(),l("span",ws,"비밀번호 변경"))],8,vs)],32)])])):(n(),l("div",hs,[s("form",{class:"auth-form",autocomplete:"off",onSubmit:C(A,["prevent"])},[e[22]||(e[22]=s("h3",null,"회원가입",-1)),s("label",gs,[e[18]||(e[18]=s("span",null,"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.username=t),placeholder:"예) new_user",minlength:"3",required:""},null,512),[[d,r.username]])]),s("label",ks,[e[19]||(e[19]=s("span",null,"이름",-1)),i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.name=t),placeholder:"한글 2~5글자",pattern:"^[가-힣]{2,5}$",required:""},null,512),[[d,r.name]])]),s("label",Us,[e[20]||(e[20]=s("span",null,"이메일",-1)),i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>r.email=t),type:"email",placeholder:"you@example.com",required:""},null,512),[[d,r.email]])]),s("label",Vs,[e[21]||(e[21]=s("span",null,"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>r.password=t),type:"password",placeholder:"8자 이상",minlength:"8",required:""},null,512),[[d,r.password]])]),s("button",{class:"primary-btn",disabled:g.value,type:"submit"},[g.value?(n(),l("span",Ps,"가입 중...")):(n(),l("span",Cs,"회원가입"))],8,qs)],32),s("form",{class:"auth-form",autocomplete:"off",onSubmit:C(j,["prevent"])},[e[25]||(e[25]=s("h3",null,"로그인",-1)),s("label",Fs,[e[23]||(e[23]=s("span",null,"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>p.username=t),placeholder:"아이디를 입력하세요",required:""},null,512),[[d,p.username]])]),s("label",Ss,[e[24]||(e[24]=s("span",null,"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>p.password=t),type:"password",placeholder:"비밀번호를 입력하세요",required:""},null,512),[[d,p.password]])]),s("button",{class:"primary-btn",disabled:k.value,type:"submit"},[k.value?(n(),l("span",Ds,"로그인 중...")):(n(),l("span",As,"로그인"))],8,xs)],32)])),o.success?(n(),l("p",js,v(o.success),1)):P("",!0),o.error?(n(),l("p",Bs,v(o.error),1)):P("",!0)]))}};export{Ns as default};
