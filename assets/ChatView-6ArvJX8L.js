import{r as f,m as D,c as N,u as fe,K as z,o as pe,L as _e,a as s,l as o,b as e,i as R,t as u,F as ae,g as ne,n as T,p as w,s as ee,q as A,y as le,v as B,M as he,N as Ce,O as ye,P as re,Q as be,d as oe,w as ue,e as de,f as Le,R as Te,S as Ae}from"./index-TgyCev0X.js";const Ee={class:"card border-0"},Ue={class:"card-body"},Oe={class:"d-flex flex-column flex-lg-row justify-content-between gap-3 mb-3"},Ne={class:"text-white-50 small mb-0"},Ve={class:"text-white-50 small mb-0"},je={class:"d-flex gap-2 align-items-start"},We=["disabled"],Me={key:0},Be={key:1},De={key:0,class:"alert alert-danger"},Pe={key:1,class:"alert alert-success"},Ie={key:0,class:"text-center text-white-50 my-5"},Ke={class:"d-flex justify-content-between align-items-center"},Fe={class:"mb-0 mt-1"},Je={key:2,class:"alert alert-warning mb-0"},qe={key:3},He={class:"alert alert-info mb-3"},Ye={key:0,class:"form-check form-switch mb-3"},ze={class:"form-check-label text-white-50",for:"globalChatAnon"},Ge={key:1,class:"text-white-50 small"},Qe={key:2,class:"alert alert-warning mt-2"},Xe=["disabled"],Ze={key:0},et={key:1},tt="오픈 라운지",me=80,st=4e3,ot={__name:"GlobalChatPanel",setup(we){const{profile:c,ensureProfileLoaded:te}=fe(),g=f(null),x=f([]),V=f(!1),E=f(!1),i=D({status:"idle",detail:"실시간 연결을 준비 중입니다."}),b=D({content:"",is_anonymous:!0}),d=D({error:"",info:"",form:""}),S=f(null),v=f(null);let C=null,j=!1;const m=N(()=>!!c.value?.user?.is_staff),p=N(()=>!!(c.value&&g.value&&b.content.trim())&&i.status==="open"),_=N(()=>{const r=c.value?.user;if(!r)return"";const l=r.email||"이메일 정보 없음";return`${r.username} 님으로 접속 중입니다. (${l})`}),P={idle:"실시간 연결을 준비 중입니다.",connecting:"실시간 연결을 준비 중입니다...",open:"실시간 연결됨 · 새 메시지가 자동으로 표시됩니다.",closed:"실시간 연결이 끊어졌습니다. 잠시 후 재시도합니다."},h=(r,l)=>{i.status=r,i.detail=l||P[r]||""},U=f((()=>{if(typeof window>"u")return null;const r=he();try{const l=new URL(r,window.location.origin);return`${l.protocol==="https:"?"wss:":"ws:"}//${l.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})()),W=()=>{Ce(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})},k=()=>{if(j=!1,C&&(clearTimeout(C),C=null),v.value)try{v.value.close()}catch{}v.value=null,c.value?h("idle"):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")},G=()=>{const r=be();return!r||!g.value||!U.value?null:`${U.value}/ws/chatrooms/${g.value.id}/?token=${encodeURIComponent(r)}`},M=r=>{if(!v.value||v.value.readyState!==WebSocket.OPEN)return d.error="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해주세요.",h("connecting"),!1;try{return v.value.send(JSON.stringify(r)),!0}catch(l){return console.error("WebSocket 전송 오류",l),d.error="실시간 메시지를 전송하지 못했습니다.",!1}},I=()=>{d.error="",M({action:"fetch_history"})||(d.info="")},Q=r=>{try{const l=JSON.parse(r.data);l.event==="history"?(x.value=Array.isArray(l.messages)?l.messages.slice(-me):[],W(),d.info=""):l.event==="message"?l.message&&(x.value=[...x.value,l.message].slice(-me),W()):l.event==="error"&&(d.error=l.detail||"실시간 채팅 오류가 발생했습니다.")}catch(l){console.error("WebSocket 메시지 파싱 실패",l)}},q=()=>{if(!c.value||!g.value){k();return}const r=G();if(!r){d.error="실시간 연결 정보를 계산하지 못했습니다.";return}k(),j=!0,h("connecting"),v.value=new WebSocket(r),v.value.addEventListener("open",()=>{h("open"),d.info="실시간 연결이 완료되었습니다.",I()}),v.value.addEventListener("message",Q),v.value.addEventListener("close",()=>{v.value=null,j&&c.value&&g.value?(h("closed"),C=window.setTimeout(()=>{C=null,q()},st)):h("idle")}),v.value.addEventListener("error",l=>{console.error("WebSocket error",l),d.error="실시간 연결 중 문제가 발생했습니다."})},X=async()=>{const r=await ye(),l=Array.isArray(r?.rooms)?r.rooms:[];if(!l.length)throw new Error("입장 가능한 공개 채팅방이 없습니다.");let y=l.find(F=>F.name===tt)||l.find(F=>!F.is_private)||l[0];if(!y)throw new Error("입장 가능한 공개 채팅방이 없습니다.");return y.is_member||(y=(await re({name:y.name}))?.room||y),y},H=async()=>{if(!c.value){k();return}V.value=!0,d.error="",d.info="";try{const r=await X();g.value=r,x.value=[],q()}catch(r){console.error(r),g.value=null,d.error=r?.message||"채팅방 정보를 불러오지 못했습니다."}finally{V.value=!1}},O=()=>{if(d.form="",!c.value){d.form="로그인 후 이용해 주세요.";return}if(!g.value){d.form="입장 가능한 공개 채팅방이 없습니다.";return}const r=b.content.trim();if(!r){d.form="메시지를 입력해 주세요.";return}const l={action:"send_message",content:r,is_anonymous:m.value?!1:b.is_anonymous};E.value=!0,M(l)&&(b.content=""),E.value=!1},K=r=>{r.key!=="Enter"||r.shiftKey||r.isComposing||(r.preventDefault(),O())};return z(c,(r,l)=>{r?l||(b.is_anonymous=!m.value,H()):(b.content="",b.is_anonymous=!0,g.value=null,x.value=[],k(),h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다."))},{immediate:!1}),z(m,r=>{r&&(b.is_anonymous=!1)},{immediate:!0}),z(x,W),pe(async()=>{await te(),c.value?(b.is_anonymous=!m.value,await H()):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")}),_e(()=>{k()}),(r,l)=>(o(),s("div",Ee,[e("div",Ue,[e("div",Oe,[e("div",null,[l[2]||(l[2]=e("h5",{class:"text-light mb-1"},"실시간 자유 채팅",-1)),l[3]||(l[3]=e("p",{class:"text-white-50 mb-0"}," 누구나 참여할 수 있는 공개 채팅방입니다. 새 메시지는 실시간으로 표시됩니다. ",-1)),e("p",Ne,u(g.value?`${g.value.name} · 정원 ${g.value.member_count}/${g.value.capacity}`:"채팅방 준비 중"),1),e("p",Ve,u(i.detail),1)]),e("div",je,[e("button",{class:"btn btn-outline-info nav-hover",disabled:V.value,type:"button",onClick:H},[V.value?(o(),s("span",Me,"준비 중...")):(o(),s("span",Be,"다시 연결"))],8,We),e("button",{class:"btn btn-outline-light nav-hover",type:"button",onClick:I},"즉시 새로고침")])]),d.error?(o(),s("div",De,u(d.error),1)):d.info?(o(),s("div",Pe,u(d.info),1)):R("",!0),e("div",{ref_key:"messageContainer",ref:S,class:"chat-messages list-group list-group-flush mb-3",style:{"max-height":"420px","overflow-y":"auto"}},[x.value.length?R("",!0):(o(),s("p",Ie,"아직 대화가 없습니다. 첫 메시지를 남겨보세요!")),(o(!0),s(ae,null,ne(x.value,y=>(o(),s("article",{key:y.id,class:"list-group-item bg-transparent text-light"},[e("div",Ke,[e("span",{class:T(["fw-semibold",{"text-warning":y.is_anonymous}])},u(y.display_name||(y.is_anonymous?"익명":"사용자")),3),e("small",null,u(new Date(y.created_at).toLocaleString("ko-KR",{dateStyle:"short",timeStyle:"short"})),1)]),e("p",Fe,u(y.content),1)]))),128))],512),w(c)?(o(),s("div",qe,[e("div",He,u(_.value),1),e("form",{autocomplete:"off",onSubmit:ee(O,["prevent"])},[m.value?(o(),s("p",Ge,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(o(),s("div",Ye,[A(e("input",{id:"globalChatAnon","onUpdate:modelValue":l[0]||(l[0]=y=>b.is_anonymous=y),class:"form-check-input",type:"checkbox"},null,512),[[le,b.is_anonymous]]),e("label",ze,u(b.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),A(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=y=>b.content=y),class:"form-control",placeholder:"지금 떠오르는 이야기를 적어보세요 (최대 500자)",maxlength:"500",rows:"4",onKeydown:K},null,544),[[B,b.content]]),d.form?(o(),s("div",Qe,u(d.form),1)):R("",!0),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:E.value||!p.value,type:"submit"},[E.value?(o(),s("span",Ze,"전송 중...")):(o(),s("span",et,"메시지 전송"))],8,Xe)],32)])):(o(),s("div",Je," 로그인한 사용자만 자유 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])]))}},at={class:"panel"},nt={class:"d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3 mb-4"},lt={class:"d-flex align-items-center gap-2 mb-2"},rt={class:"d-flex flex-wrap gap-2"},it={class:"row g-3 mb-4"},ct={class:"col-12 col-lg-4"},ut={class:"soft-card h-100"},dt={class:"mb-1 text-light"},mt={class:"text-white-50 mb-0"},vt={class:"col-12 col-lg-4"},ft={class:"soft-card h-100"},pt={class:"d-flex align-items-center gap-2"},_t={class:"text-white-50"},ht={class:"col-12 col-lg-4"},yt={class:"soft-card h-100"},bt={class:"d-block mb-1 text-light"},wt={class:"text-white-50"},gt={class:"nav nav-pills gap-2 mb-4 flex-wrap"},kt={key:0},xt={key:1},$t={class:"row g-4"},St={class:"col-12 col-lg-4"},Rt={class:"card border-0 mb-4"},Ct={class:"card-body"},Lt={key:0,class:"alert alert-info"},Tt={key:1,class:"alert alert-danger"},At={key:2,class:"d-flex flex-column gap-2 room-list"},Et={key:0,class:"panel-placeholder"},Ut={class:"mb-0 fw-semibold text-light"},Ot={class:"text-white-50"},Nt=["disabled","onClick"],Vt={key:0},jt={key:1},Wt={key:2},Mt={key:3},Bt={key:4},Dt={class:"card border-0 mb-4"},Pt={class:"card-body"},It={class:"col-12"},Kt={class:"col-12"},Ft={class:"col-12 form-check form-switch"},Jt={key:0,class:"col-12"},qt={class:"col-12"},Ht=["disabled"],Yt={key:0},zt={key:1},Gt={class:"card border-0"},Qt={class:"card-body"},Xt={class:"col-12"},Zt={class:"col-12"},es={class:"col-12"},ts=["disabled"],ss={key:0},os={key:1},as={class:"col-12 col-lg-8"},ns={class:"card border-0 h-100 chat-frame"},ls={class:"card-body d-flex flex-column gap-3 h-100"},rs={class:"d-flex justify-content-between align-items-start flex-wrap gap-2"},is={class:"text-light mb-1"},cs={class:"text-white-50 mb-0"},us={key:0,class:"text-white-50 small mb-0"},ds={class:"d-flex gap-2"},ms=["disabled"],vs={key:0},fs={key:1},ps={key:0,class:"alert alert-info"},_s={key:1,class:"alert alert-secondary"},hs={key:2,class:"chat-messages list-group list-group-flush"},ys={class:"d-inline-block text-start",style:{"max-width":"80%"}},bs={key:0,class:"text-muted"},ws={key:2,class:"text-muted"},gs={key:3,class:"alert alert-warning"},ks={key:4,class:"alert alert-danger"},xs={key:5,class:"alert alert-warning"},$s={key:0,class:"form-check form-switch mb-3"},Ss={class:"form-check-label text-white-50",for:"chatAnon"},Rs={key:1,class:"text-white-50 small"},Cs=["disabled"],Ls={key:0},Ts={key:1},As={key:7,class:"alert alert-info mt-auto"},Es={key:8,class:"alert alert-warning mt-auto"},ve=80,Os={__name:"ChatView",setup(we){const{profile:c,ensureProfileLoaded:te}=fe(),g=N(()=>!!c.value?.user?.is_staff),x=f([]),V=f(!1),E=f(""),i=f(null),b=f(null),d=f(!1),S=f([]),v=D({content:"",is_anonymous:!0}),C=f(!1),j=f(!1),m=f(""),p=D({status:"idle",error:""}),_=D({name:"",capacity:10,is_private:!1,password:""}),P=f(!1),h=D({name:"",password:""}),J=f(!1);let U=null,W=!1;const k=f(null),G=N(()=>!g.value),M=f("global"),I=N(()=>{switch(p.status){case"open":return"실시간 연결됨";case"connecting":return"연결 준비 중";case"closed":return"재연결 대기";default:return"대기 중"}}),Q=N(()=>p.status==="open"?"pill-success":p.status==="connecting"?"pill-warning":p.status==="closed"?"pill-danger":"pill-muted"),q=N(()=>i.value?`정원 ${i.value.member_count}/${i.value.capacity} · ${i.value.is_private?"비공개":"공개"}`:"입장 후 메시지를 보낼 수 있습니다."),X=a=>{if(!a)return"";const t=typeof a=="string"?new Date(a):a;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"short",timeStyle:"short"}).format(t)},H=N(()=>!!(c.value&&i.value&&v.content.trim())&&p.status==="open"),O=async()=>{V.value=!0,E.value="";try{const a=await ye();x.value=Array.isArray(a?.rooms)?a.rooms:[]}catch(a){console.error(a),E.value="채팅방 목록을 불러오지 못했습니다."}finally{V.value=!1}},K=a=>{i.value=a||null},l=(()=>{if(typeof window>"u")return null;const a=he();try{const t=new URL(a,window.location.origin);return`${t.protocol==="https:"?"wss:":"ws:"}//${t.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})(),y=a=>{const t=be();return!t||!l?null:`${l}/ws/chatrooms/${a}/?token=${encodeURIComponent(t)}`},F=()=>{U&&(clearTimeout(U),U=null)},Z=()=>{if(W=!1,F(),k.value)try{k.value.close()}catch{}k.value=null,i.value?p.status="closed":p.status="idle"},ge=()=>{!W||U||(U=window.setTimeout(()=>{U=null,i.value&&se(i.value.id)},3e3))},se=a=>{if(Z(),!a)return;const t=y(a);if(!t){m.value="로그인 후 이용해 주세요.";return}W=!0,p.status="connecting",p.error="",C.value=!0;const $=new WebSocket(t);k.value=$,$.addEventListener("open",()=>{p.status="open",p.error="",$.send(JSON.stringify({action:"fetch_history"}))}),$.addEventListener("message",n=>{try{const L=JSON.parse(n.data);if(L.event==="history")S.value=Array.isArray(L.messages)?L.messages.slice(-ve):[],C.value=!1;else if(L.event==="message"){const ce=L.message;ce&&(S.value=[...S.value,ce].slice(-ve))}else L.event==="error"&&(m.value=L.detail||"실시간 채팅 오류가 발생했습니다.")}catch(L){console.error("WebSocket message parse error",L)}}),$.addEventListener("close",()=>{k.value=null,W&&i.value?(p.status="closed",ge()):p.status=i.value?"closed":"idle"}),$.addEventListener("error",n=>{console.error("WebSocket error",n),p.error="실시간 연결에 문제가 발생했습니다."})};z(g,a=>{a&&(v.is_anonymous=!1)},{immediate:!0}),z(i,a=>{S.value=[],m.value="",a?se(a.id):(Z(),C.value=!1)});const Y=()=>c.value?!0:(m.value="로그인 후 이용해 주세요.",!1),ke=async a=>{if(Y()){b.value=a.id,m.value="";try{const t=await re({name:a.name});K(t?.room??null),a.is_private||await O()}catch(t){console.error(t),m.value=t?.payload?.detail||"채팅방에 입장하지 못했습니다."}finally{b.value=null}}},xe=async()=>{if(Y()){if(!h.name.trim()){m.value="비공개 채팅방 이름을 입력해주세요.";return}if(!h.password.trim()){m.value="비공개 채팅방 비밀번호를 입력해주세요.";return}J.value=!0,m.value="";try{const a=await re({name:h.name.trim(),password:h.password});K(a?.room??null),h.name="",h.password=""}catch(a){console.error(a),m.value=a?.payload?.detail||"비공개 채팅방에 입장하지 못했습니다."}finally{J.value=!1}}},$e=async()=>{if(Y()){P.value=!0,m.value="";try{const a=await Ae({name:_.name.trim(),capacity:Number(_.capacity),is_private:_.is_private,password:_.is_private?_.password:""});if(!a?.room)throw new Error("채팅방 응답이 없습니다.");K(a.room),a.room.is_private||await O(),_.name="",_.password="",_.capacity=10,_.is_private=!1}catch(a){console.error(a),m.value=a?.payload?.detail||(a?.payload&&typeof a.payload=="object"?Object.values(a.payload).flat().join(" "):"채팅방을 생성하지 못했습니다.")}finally{P.value=!1}}},Se=async()=>{if(!(!i.value||!Y())){d.value=!0,m.value="";try{await Te(i.value.id),Z(),K(null),await O()}catch(a){console.error(a),m.value=a?.payload?.detail||"채팅방에서 나가지 못했습니다."}finally{d.value=!1}}},ie=()=>{if(!Y())return;if(!i.value){m.value="먼저 채팅방에 입장해 주세요.";return}if(p.status!=="open"||!k.value){m.value="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해 주세요.",i.value&&se(i.value.id);return}const a=v.content.trim();if(!a){m.value="메시지를 입력해 주세요.";return}j.value=!0;const t={action:"send_message",content:a,is_anonymous:G.value?v.is_anonymous:!1};try{k.value.send(JSON.stringify(t)),v.content="",m.value=""}catch($){console.error($),m.value="메시지를 전송하지 못했습니다."}finally{j.value=!1}},Re=a=>{a.key!=="Enter"||a.shiftKey||a.isComposing||(a.preventDefault(),ie())};return pe(async()=>{await te(),await O()}),_e(()=>{Z()}),(a,t)=>{const $=Le("router-link");return o(),s("section",at,[e("div",nt,[e("div",null,[e("div",lt,[t[10]||(t[10]=e("span",{class:"pill pill-muted"},"오픈 채팅",-1)),e("span",{class:T(["pill",Q.value])},u(I.value),3)]),t[11]||(t[11]=e("h2",{class:"h4 text-light mb-1"},"누구나 참여하는 오픈 라운지",-1)),t[12]||(t[12]=e("p",{class:"text-white-50 mb-0"}," 원하는 방을 선택해 바로 대화하거나, 새 방을 만들어 초대 코드를 공유하세요. ",-1))]),e("div",rt,[oe($,{class:"btn btn-outline-light nav-hover",to:"/"},{default:ue(()=>[...t[13]||(t[13]=[de("메인으로",-1)])]),_:1}),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:O},"목록 새로고침")])]),e("div",it,[e("div",ct,[e("div",ut,[t[14]||(t[14]=e("p",{class:"text-white-50 small mb-1"},"내 상태",-1)),e("h6",dt,u(w(c)?w(c).user.username:"로그인 필요"),1),e("p",mt,u(w(c)?G.value?"익명/닉네임 선택 가능":"관리자 · 실명 발송":"로그인 후 참여 가능"),1)])]),e("div",vt,[e("div",ft,[t[15]||(t[15]=e("p",{class:"text-white-50 small mb-1"},"실시간 연결",-1)),e("div",pt,[e("span",{class:T(["pill",Q.value])},u(I.value),3),e("small",_t,u(p.error||"끊기면 자동으로 다시 연결합니다."),1)])])]),e("div",ht,[e("div",yt,[t[16]||(t[16]=e("p",{class:"text-white-50 small mb-1"},"현재 방",-1)),e("strong",bt,u(i.value?i.value.name:"아직 선택되지 않음"),1),e("small",wt,u(q.value),1)])])]),e("div",gt,[e("button",{class:T(["btn nav-hover",M.value==="global"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[0]||(t[0]=n=>M.value="global")}," 실시간 자유 채팅 ",2),e("button",{class:T(["btn nav-hover",M.value==="rooms"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[1]||(t[1]=n=>M.value="rooms")}," 채팅방 관리 ",2)]),M.value==="global"?(o(),s("div",kt,[oe(ot)])):(o(),s("div",xt,[t[29]||(t[29]=e("div",{class:"alert alert-info mb-4"}," 원하는 분위기의 방이 없다면 직접 만들고 링크를 공유하세요. 비공개 방은 목록에 표시되지 않고 비밀번호로만 입장합니다. ",-1)),e("div",$t,[e("div",St,[e("div",Rt,[e("div",Ct,[e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t[17]||(t[17]=e("h5",{class:"text-light mb-0"},"공개 채팅방",-1)),e("button",{class:"btn btn-sm btn-outline-info nav-hover",type:"button",onClick:O},"새로고침")]),t[18]||(t[18]=e("p",{class:"text-white-50 small mb-3"},"목록에는 누구나 입장 가능한 공개형 채팅방만 표시됩니다.",-1)),V.value?(o(),s("div",Lt,"채팅방 목록을 불러오는 중...")):E.value?(o(),s("div",Tt,u(E.value),1)):(o(),s("div",At,[x.value.length?R("",!0):(o(),s("div",Et,"아직 공개 채팅방이 없습니다.")),(o(!0),s(ae,null,ne(x.value,n=>(o(),s("article",{key:n.id,class:"room-tile d-flex justify-content-between align-items-center"},[e("div",null,[e("p",Ut,u(n.name),1),e("small",Ot,u(n.member_count)+"/"+u(n.capacity)+" · "+u(n.owner_username||"운영자"),1)]),e("button",{class:T(["btn btn-sm nav-hover",n.is_member?"btn-secondary":"btn-outline-light"]),disabled:b.value===n.id||n.member_count>=n.capacity||n.is_member&&i.value&&i.value.id===n.id,type:"button",onClick:L=>ke(n)},[b.value===n.id?(o(),s("span",Vt,"입장 중...")):n.is_member&&i.value&&i.value.id===n.id?(o(),s("span",jt,"이용 중")):n.is_member?(o(),s("span",Wt,"입장 완료")):n.member_count>=n.capacity?(o(),s("span",Mt,"정원 초과")):(o(),s("span",Bt,"입장"))],10,Nt)]))),128))]))])]),e("div",Dt,[e("div",Pt,[t[24]||(t[24]=e("h5",{class:"text-light mb-3"},"채팅방 생성",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:ee($e,["prevent"])},[e("div",It,[t[19]||(t[19]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>_.name=n),class:"form-control",maxlength:"50",placeholder:"예) 주말 영화 추천방",required:""},null,512),[[B,_.name]])]),e("div",Kt,[t[20]||(t[20]=e("label",{class:"form-label text-white-50"},"정원 (2~200명)",-1)),A(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>_.capacity=n),class:"form-control",min:"2",max:"200",type:"number",required:""},null,512),[[B,_.capacity,void 0,{number:!0}]])]),e("div",Ft,[A(e("input",{id:"createPrivate","onUpdate:modelValue":t[4]||(t[4]=n=>_.is_private=n),class:"form-check-input",type:"checkbox"},null,512),[[le,_.is_private]]),t[21]||(t[21]=e("label",{class:"form-check-label text-white-50",for:"createPrivate"},"비공개 채팅방",-1))]),_.is_private?(o(),s("div",Jt,[t[22]||(t[22]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),A(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>_.password=n),class:"form-control",type:"password",minlength:"4",required:""},null,512),[[B,_.password]]),t[23]||(t[23]=e("small",{class:"text-white-50"},"목록에 표시되지 않으며 비밀번호로만 입장합니다.",-1))])):R("",!0),e("div",qt,[e("button",{class:"btn btn-primary nav-hover w-100",disabled:P.value,type:"submit"},[P.value?(o(),s("span",Yt,"생성 중...")):(o(),s("span",zt,"채팅방 생성"))],8,Ht)])],32)])]),e("div",Gt,[e("div",Qt,[t[27]||(t[27]=e("h5",{class:"text-light mb-3"},"비공개 채팅방 입장",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:ee(xe,["prevent"])},[e("div",Xt,[t[25]||(t[25]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),A(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>h.name=n),class:"form-control",placeholder:"예) 프로젝트 A",required:""},null,512),[[B,h.name]])]),e("div",Zt,[t[26]||(t[26]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),A(e("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>h.password=n),class:"form-control",type:"password",required:""},null,512),[[B,h.password]])]),e("div",es,[e("button",{class:"btn btn-outline-light nav-hover w-100",disabled:J.value,type:"submit"},[J.value?(o(),s("span",ss,"입장 중...")):(o(),s("span",os,"입장하기"))],8,ts)])],32)])])]),e("div",as,[e("div",ns,[e("div",ls,[e("div",rs,[e("div",null,[e("h5",is,u(i.value?i.value.name:"채팅방을 선택해 주세요"),1),e("p",cs,u(i.value?q.value:"좌측에서 채팅방을 선택하거나 새로 만들 수 있습니다."),1),i.value?(o(),s("p",us,u(I.value)+" · 끊기면 자동으로 재연결합니다. ",1)):R("",!0)]),e("div",ds,[oe($,{class:"btn btn-outline-light btn-sm nav-hover",to:"/boards"},{default:ue(()=>[...t[28]||(t[28]=[de("게시판 보기",-1)])]),_:1}),i.value?(o(),s("button",{key:0,class:"btn btn-outline-danger btn-sm nav-hover",disabled:d.value,type:"button",onClick:Se},[d.value?(o(),s("span",vs,"나가는 중...")):(o(),s("span",fs,"채팅방 나가기"))],8,ms)):R("",!0)])]),C.value?(o(),s("div",ps,"채팅 메시지를 불러오는 중...")):i.value&&!S.value.length?(o(),s("div",_s," 아직 대화가 없습니다. 첫 메시지를 남겨보세요! ")):i.value?(o(),s("div",hs,[(o(!0),s(ae,null,ne(S.value,n=>(o(),s("article",{key:n.id,class:T(["chat-message list-group-item border-0 bg-transparent px-0",{"text-end":w(c)&&n.username===w(c).user.username}])},[e("div",ys,[e("div",{class:T(["d-flex align-items-end gap-2 mb-1",{"justify-content-end":w(c)&&n.username===w(c).user.username}])},[w(c)&&n.username===w(c).user.username?(o(),s("small",bs,u(X(n.created_at)),1)):R("",!0),w(c)&&n.username===w(c).user.username?R("",!0):(o(),s("span",{key:1,class:T(["fw-semibold badge bg-light text-dark border",{"text-warning":n.is_anonymous}])},u(n.display_name),3)),w(c)&&n.username===w(c).user.username?R("",!0):(o(),s("small",ws,u(X(n.created_at)),1))],2),e("div",{class:T(["p-3 rounded-3 shadow-sm",[w(c)&&n.username===w(c).user.username?"bg-primary text-white fw-bold rounded-top-right-0":"bg-white border fw-normal rounded-top-left-0"]])},u(n.content),3)])],2))),128))])):(o(),s("div",gs,"채팅방을 선택하거나 새로 만들어주세요.")),m.value?(o(),s("div",ks,u(m.value),1)):p.error?(o(),s("div",xs,u(p.error),1)):R("",!0),w(c)&&i.value?(o(),s("form",{key:6,class:"chat-form mt-auto",autocomplete:"off",onSubmit:ee(ie,["prevent"])},[g.value?(o(),s("p",Rs,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(o(),s("div",$s,[A(e("input",{id:"chatAnon","onUpdate:modelValue":t[8]||(t[8]=n=>v.is_anonymous=n),class:"form-check-input",type:"checkbox"},null,512),[[le,v.is_anonymous]]),e("label",Ss,u(v.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),A(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=n=>v.content=n),class:"form-control",name:"chat-content",placeholder:"지금 떠오르는 생각을 적어보세요 (최대 500자)",maxlength:"500",onKeydown:Re},null,544),[[B,v.content]]),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:j.value||!H.value,type:"submit"},[j.value?(o(),s("span",Ls,"전송 중...")):(o(),s("span",Ts,"메시지 전송"))],8,Cs)],32)):w(c)?(o(),s("div",As," 채팅방에 입장해야 메시지를 보낼 수 있습니다. ")):(o(),s("div",Es," 로그인한 사용자만 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])])])])]))])}}};export{Os as default};
