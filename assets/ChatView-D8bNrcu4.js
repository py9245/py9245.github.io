import{r as v,j as B,A as E,u as fe,J as z,o as pe,K as _e,c as o,i as a,a as e,e as V,t as c,F as ae,p as ne,n as W,k as K,m as Z,l as C,s as le,v as M,L as he,M as Ce,N as ye,O as re,P as be,d as oe,w as ue,b as de,f as Le,Q as Te,R as Ae}from"./index-DBq9rXX7.js";const Ee={class:"card border-0"},Ue={class:"card-body"},Oe={class:"d-flex flex-column flex-lg-row justify-content-between gap-3 mb-3"},Ne={class:"text-white-50 small mb-0"},je={class:"text-white-50 small mb-0"},Ve={class:"d-flex gap-2 align-items-start"},We=["disabled"],Me={key:0},Be={key:1},De={key:0,class:"alert alert-danger"},Pe={key:1,class:"alert alert-success"},Ie={key:0,class:"text-center text-white-50 my-5"},Je={class:"d-flex justify-content-between align-items-center"},Ke={class:"mb-0 mt-1"},Fe={key:2,class:"alert alert-warning mb-0"},qe={key:3},He={class:"alert alert-info mb-3"},Ye={key:0,class:"form-check form-switch mb-3"},ze={class:"form-check-label text-white-50",for:"globalChatAnon"},Ge={key:1,class:"text-white-50 small"},Qe={key:2,class:"alert alert-warning mt-2"},Xe=["disabled"],Ze={key:0},et={key:1},tt="오픈 라운지",me=80,st=4e3,ot={__name:"GlobalChatPanel",setup(we){const{profile:f,ensureProfileLoaded:ee}=fe(),w=v(null),k=v([]),U=v(!1),L=v(!1),i=B({status:"idle",detail:"실시간 연결을 준비 중입니다."}),b=B({content:"",is_anonymous:!0}),u=B({error:"",info:"",form:""}),$=v(null),m=v(null);let S=null,O=!1;const d=E(()=>!!f.value?.user?.is_staff),p=E(()=>!!(f.value&&w.value&&b.content.trim())&&i.status==="open"),_=E(()=>{const r=f.value?.user;if(!r)return"";const l=r.email||"이메일 정보 없음";return`${r.username} 님으로 접속 중입니다. (${l})`}),D={idle:"실시간 연결을 준비 중입니다.",connecting:"실시간 연결을 준비 중입니다...",open:"실시간 연결됨 · 새 메시지가 자동으로 표시됩니다.",closed:"실시간 연결이 끊어졌습니다. 잠시 후 재시도합니다."},h=(r,l)=>{i.status=r,i.detail=l||D[r]||""},T=v((()=>{if(typeof window>"u")return null;const r=he();try{const l=new URL(r,window.location.origin);return`${l.protocol==="https:"?"wss:":"ws:"}//${l.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})()),N=()=>{Ce(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})},g=()=>{if(O=!1,S&&(clearTimeout(S),S=null),m.value)try{m.value.close()}catch{}m.value=null,f.value?h("idle"):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")},G=()=>{const r=be();return!r||!w.value||!T.value?null:`${T.value}/ws/chatrooms/${w.value.id}/?token=${encodeURIComponent(r)}`},j=r=>{if(!m.value||m.value.readyState!==WebSocket.OPEN)return u.error="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해주세요.",h("connecting"),!1;try{return m.value.send(JSON.stringify(r)),!0}catch(l){return console.error("WebSocket 전송 오류",l),u.error="실시간 메시지를 전송하지 못했습니다.",!1}},P=()=>{u.error="",j({action:"fetch_history"})||(u.info="")},Q=r=>{try{const l=JSON.parse(r.data);l.event==="history"?(k.value=Array.isArray(l.messages)?l.messages.slice(-me):[],N(),u.info=""):l.event==="message"?l.message&&(k.value=[...k.value,l.message].slice(-me),N()):l.event==="error"&&(u.error=l.detail||"실시간 채팅 오류가 발생했습니다.")}catch(l){console.error("WebSocket 메시지 파싱 실패",l)}},q=()=>{if(!f.value||!w.value){g();return}const r=G();if(!r){u.error="실시간 연결 정보를 계산하지 못했습니다.";return}g(),O=!0,h("connecting"),m.value=new WebSocket(r),m.value.addEventListener("open",()=>{h("open"),u.info="실시간 연결이 완료되었습니다.",P()}),m.value.addEventListener("message",Q),m.value.addEventListener("close",()=>{m.value=null,O&&f.value&&w.value?(h("closed"),S=window.setTimeout(()=>{S=null,q()},st)):h("idle")}),m.value.addEventListener("error",l=>{console.error("WebSocket error",l),u.error="실시간 연결 중 문제가 발생했습니다."})},te=async()=>{const r=await ye(),l=Array.isArray(r?.rooms)?r.rooms:[];if(!l.length)throw new Error("입장 가능한 공개 채팅방이 없습니다.");let y=l.find(J=>J.name===tt)||l.find(J=>!J.is_private)||l[0];if(!y)throw new Error("입장 가능한 공개 채팅방이 없습니다.");return y.is_member||(y=(await re({name:y.name}))?.room||y),y},H=async()=>{if(!f.value){g();return}U.value=!0,u.error="",u.info="";try{const r=await te();w.value=r,k.value=[],q()}catch(r){console.error(r),w.value=null,u.error=r?.message||"채팅방 정보를 불러오지 못했습니다."}finally{U.value=!1}},A=()=>{if(u.form="",!f.value){u.form="로그인 후 이용해 주세요.";return}if(!w.value){u.form="입장 가능한 공개 채팅방이 없습니다.";return}const r=b.content.trim();if(!r){u.form="메시지를 입력해 주세요.";return}const l={action:"send_message",content:r,is_anonymous:d.value?!1:b.is_anonymous};L.value=!0,j(l)&&(b.content=""),L.value=!1},I=r=>{r.key!=="Enter"||r.shiftKey||r.isComposing||(r.preventDefault(),A())};return z(f,(r,l)=>{r?l||(b.is_anonymous=!d.value,H()):(b.content="",b.is_anonymous=!0,w.value=null,k.value=[],g(),h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다."))},{immediate:!1}),z(d,r=>{r&&(b.is_anonymous=!1)},{immediate:!0}),z(k,N),pe(async()=>{await ee(),f.value?(b.is_anonymous=!d.value,await H()):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")}),_e(()=>{g()}),(r,l)=>(a(),o("div",Ee,[e("div",Ue,[e("div",Oe,[e("div",null,[l[2]||(l[2]=e("h5",{class:"text-light mb-1"},"실시간 자유 채팅",-1)),l[3]||(l[3]=e("p",{class:"text-white-50 mb-0"}," 누구나 참여할 수 있는 공개 채팅방입니다. 새 메시지는 실시간으로 표시됩니다. ",-1)),e("p",Ne,c(w.value?`${w.value.name} · 정원 ${w.value.member_count}/${w.value.capacity}`:"채팅방 준비 중"),1),e("p",je,c(i.detail),1)]),e("div",Ve,[e("button",{class:"btn btn-outline-info nav-hover",disabled:U.value,type:"button",onClick:H},[U.value?(a(),o("span",Me,"준비 중...")):(a(),o("span",Be,"다시 연결"))],8,We),e("button",{class:"btn btn-outline-light nav-hover",type:"button",onClick:P},"즉시 새로고침")])]),u.error?(a(),o("div",De,c(u.error),1)):u.info?(a(),o("div",Pe,c(u.info),1)):V("",!0),e("div",{ref_key:"messageContainer",ref:$,class:"chat-messages list-group list-group-flush mb-3",style:{"max-height":"420px","overflow-y":"auto"}},[k.value.length?V("",!0):(a(),o("p",Ie,"아직 대화가 없습니다. 첫 메시지를 남겨보세요!")),(a(!0),o(ae,null,ne(k.value,y=>(a(),o("article",{key:y.id,class:"list-group-item bg-transparent text-light"},[e("div",Je,[e("span",{class:W(["fw-semibold",{"text-warning":y.is_anonymous}])},c(y.display_name||(y.is_anonymous?"익명":"사용자")),3),e("small",null,c(new Date(y.created_at).toLocaleString("ko-KR",{dateStyle:"short",timeStyle:"short"})),1)]),e("p",Ke,c(y.content),1)]))),128))],512),K(f)?(a(),o("div",qe,[e("div",He,c(_.value),1),e("form",{autocomplete:"off",onSubmit:Z(A,["prevent"])},[d.value?(a(),o("p",Ge,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(a(),o("div",Ye,[C(e("input",{id:"globalChatAnon","onUpdate:modelValue":l[0]||(l[0]=y=>b.is_anonymous=y),class:"form-check-input",type:"checkbox"},null,512),[[le,b.is_anonymous]]),e("label",ze,c(b.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),C(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=y=>b.content=y),class:"form-control",placeholder:"지금 떠오르는 이야기를 적어보세요 (최대 500자)",maxlength:"500",rows:"4",onKeydown:I},null,544),[[M,b.content]]),u.form?(a(),o("div",Qe,c(u.form),1)):V("",!0),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:L.value||!p.value,type:"submit"},[L.value?(a(),o("span",Ze,"전송 중...")):(a(),o("span",et,"메시지 전송"))],8,Xe)],32)])):(a(),o("div",Fe," 로그인한 사용자만 자유 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])]))}},at={class:"panel"},nt={class:"d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3 mb-4"},lt={class:"d-flex align-items-center gap-2 mb-2"},rt={class:"d-flex flex-wrap gap-2"},it={class:"row g-3 mb-4"},ct={class:"col-12 col-lg-4"},ut={class:"soft-card h-100"},dt={class:"mb-1 text-light"},mt={class:"text-white-50 mb-0"},vt={class:"col-12 col-lg-4"},ft={class:"soft-card h-100"},pt={class:"d-flex align-items-center gap-2"},_t={class:"text-white-50"},ht={class:"col-12 col-lg-4"},yt={class:"soft-card h-100"},bt={class:"d-block mb-1 text-light"},wt={class:"text-white-50"},gt={class:"nav nav-pills gap-2 mb-4 flex-wrap"},kt={key:0},xt={key:1},$t={class:"row g-4"},St={class:"col-12 col-lg-4"},Rt={class:"card border-0 mb-4"},Ct={class:"card-body"},Lt={key:0,class:"alert alert-info"},Tt={key:1,class:"alert alert-danger"},At={key:2,class:"d-flex flex-column gap-2 room-list"},Et={key:0,class:"panel-placeholder"},Ut={class:"mb-0 fw-semibold text-light"},Ot={class:"text-white-50"},Nt=["disabled","onClick"],jt={key:0},Vt={key:1},Wt={key:2},Mt={key:3},Bt={key:4},Dt={class:"card border-0 mb-4"},Pt={class:"card-body"},It={class:"col-12"},Jt={class:"col-12"},Kt={class:"col-12 form-check form-switch"},Ft={key:0,class:"col-12"},qt={class:"col-12"},Ht=["disabled"],Yt={key:0},zt={key:1},Gt={class:"card border-0"},Qt={class:"card-body"},Xt={class:"col-12"},Zt={class:"col-12"},es={class:"col-12"},ts=["disabled"],ss={key:0},os={key:1},as={class:"col-12 col-lg-8"},ns={class:"card border-0 h-100 chat-frame"},ls={class:"card-body d-flex flex-column gap-3 h-100"},rs={class:"d-flex justify-content-between align-items-start flex-wrap gap-2"},is={class:"text-light mb-1"},cs={class:"text-white-50 mb-0"},us={key:0,class:"text-white-50 small mb-0"},ds={class:"d-flex gap-2"},ms=["disabled"],vs={key:0},fs={key:1},ps={key:0,class:"alert alert-info"},_s={key:1,class:"alert alert-secondary"},hs={key:2,class:"chat-messages list-group list-group-flush"},ys={class:"d-flex justify-content-between"},bs={class:"mt-1"},ws={key:3,class:"alert alert-warning"},gs={key:4,class:"alert alert-danger"},ks={key:5,class:"alert alert-warning"},xs={key:0,class:"form-check form-switch mb-3"},$s={class:"form-check-label text-white-50",for:"chatAnon"},Ss={key:1,class:"text-white-50 small"},Rs=["disabled"],Cs={key:0},Ls={key:1},Ts={key:7,class:"alert alert-info mt-auto"},As={key:8,class:"alert alert-warning mt-auto"},ve=80,Us={__name:"ChatView",setup(we){const{profile:f,ensureProfileLoaded:ee}=fe(),w=E(()=>!!f.value?.user?.is_staff),k=v([]),U=v(!1),L=v(""),i=v(null),b=v(null),u=v(!1),$=v([]),m=B({content:"",is_anonymous:!0}),S=v(!1),O=v(!1),d=v(""),p=B({status:"idle",error:""}),_=B({name:"",capacity:10,is_private:!1,password:""}),D=v(!1),h=B({name:"",password:""}),F=v(!1);let T=null,N=!1;const g=v(null),G=E(()=>!w.value),j=v("global"),P=E(()=>{switch(p.status){case"open":return"실시간 연결됨";case"connecting":return"연결 준비 중";case"closed":return"재연결 대기";default:return"대기 중"}}),Q=E(()=>p.status==="open"?"pill-success":p.status==="connecting"?"pill-warning":p.status==="closed"?"pill-danger":"pill-muted"),q=E(()=>i.value?`정원 ${i.value.member_count}/${i.value.capacity} · ${i.value.is_private?"비공개":"공개"}`:"입장 후 메시지를 보낼 수 있습니다."),te=s=>{if(!s)return"";const t=typeof s=="string"?new Date(s):s;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"short",timeStyle:"short"}).format(t)},H=E(()=>!!(f.value&&i.value&&m.content.trim())&&p.status==="open"),A=async()=>{U.value=!0,L.value="";try{const s=await ye();k.value=Array.isArray(s?.rooms)?s.rooms:[]}catch(s){console.error(s),L.value="채팅방 목록을 불러오지 못했습니다."}finally{U.value=!1}},I=s=>{i.value=s||null},l=(()=>{if(typeof window>"u")return null;const s=he();try{const t=new URL(s,window.location.origin);return`${t.protocol==="https:"?"wss:":"ws:"}//${t.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})(),y=s=>{const t=be();return!t||!l?null:`${l}/ws/chatrooms/${s}/?token=${encodeURIComponent(t)}`},J=()=>{T&&(clearTimeout(T),T=null)},X=()=>{if(N=!1,J(),g.value)try{g.value.close()}catch{}g.value=null,i.value?p.status="closed":p.status="idle"},ge=()=>{!N||T||(T=window.setTimeout(()=>{T=null,i.value&&se(i.value.id)},3e3))},se=s=>{if(X(),!s)return;const t=y(s);if(!t){d.value="로그인 후 이용해 주세요.";return}N=!0,p.status="connecting",p.error="",S.value=!0;const x=new WebSocket(t);g.value=x,x.addEventListener("open",()=>{p.status="open",p.error="",x.send(JSON.stringify({action:"fetch_history"}))}),x.addEventListener("message",n=>{try{const R=JSON.parse(n.data);if(R.event==="history")$.value=Array.isArray(R.messages)?R.messages.slice(-ve):[],S.value=!1;else if(R.event==="message"){const ce=R.message;ce&&($.value=[...$.value,ce].slice(-ve))}else R.event==="error"&&(d.value=R.detail||"실시간 채팅 오류가 발생했습니다.")}catch(R){console.error("WebSocket message parse error",R)}}),x.addEventListener("close",()=>{g.value=null,N&&i.value?(p.status="closed",ge()):p.status=i.value?"closed":"idle"}),x.addEventListener("error",n=>{console.error("WebSocket error",n),p.error="실시간 연결에 문제가 발생했습니다."})};z(w,s=>{s&&(m.is_anonymous=!1)},{immediate:!0}),z(i,s=>{$.value=[],d.value="",s?se(s.id):(X(),S.value=!1)});const Y=()=>f.value?!0:(d.value="로그인 후 이용해 주세요.",!1),ke=async s=>{if(Y()){b.value=s.id,d.value="";try{const t=await re({name:s.name});I(t?.room??null),s.is_private||await A()}catch(t){console.error(t),d.value=t?.payload?.detail||"채팅방에 입장하지 못했습니다."}finally{b.value=null}}},xe=async()=>{if(Y()){if(!h.name.trim()){d.value="비공개 채팅방 이름을 입력해주세요.";return}if(!h.password.trim()){d.value="비공개 채팅방 비밀번호를 입력해주세요.";return}F.value=!0,d.value="";try{const s=await re({name:h.name.trim(),password:h.password});I(s?.room??null),h.name="",h.password=""}catch(s){console.error(s),d.value=s?.payload?.detail||"비공개 채팅방에 입장하지 못했습니다."}finally{F.value=!1}}},$e=async()=>{if(Y()){D.value=!0,d.value="";try{const s=await Ae({name:_.name.trim(),capacity:Number(_.capacity),is_private:_.is_private,password:_.is_private?_.password:""});if(!s?.room)throw new Error("채팅방 응답이 없습니다.");I(s.room),s.room.is_private||await A(),_.name="",_.password="",_.capacity=10,_.is_private=!1}catch(s){console.error(s),d.value=s?.payload?.detail||(s?.payload&&typeof s.payload=="object"?Object.values(s.payload).flat().join(" "):"채팅방을 생성하지 못했습니다.")}finally{D.value=!1}}},Se=async()=>{if(!(!i.value||!Y())){u.value=!0,d.value="";try{await Te(i.value.id),X(),I(null),await A()}catch(s){console.error(s),d.value=s?.payload?.detail||"채팅방에서 나가지 못했습니다."}finally{u.value=!1}}},ie=()=>{if(!Y())return;if(!i.value){d.value="먼저 채팅방에 입장해 주세요.";return}if(p.status!=="open"||!g.value){d.value="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해 주세요.",i.value&&se(i.value.id);return}const s=m.content.trim();if(!s){d.value="메시지를 입력해 주세요.";return}O.value=!0;const t={action:"send_message",content:s,is_anonymous:G.value?m.is_anonymous:!1};try{g.value.send(JSON.stringify(t)),m.content="",d.value=""}catch(x){console.error(x),d.value="메시지를 전송하지 못했습니다."}finally{O.value=!1}},Re=s=>{s.key!=="Enter"||s.shiftKey||s.isComposing||(s.preventDefault(),ie())};return pe(async()=>{await ee(),await A()}),_e(()=>{X()}),(s,t)=>{const x=Le("router-link");return a(),o("section",at,[e("div",nt,[e("div",null,[e("div",lt,[t[10]||(t[10]=e("span",{class:"pill pill-muted"},"오픈 채팅",-1)),e("span",{class:W(["pill",Q.value])},c(P.value),3)]),t[11]||(t[11]=e("h2",{class:"h4 text-light mb-1"},"누구나 참여하는 오픈 라운지",-1)),t[12]||(t[12]=e("p",{class:"text-white-50 mb-0"}," 원하는 방을 선택해 바로 대화하거나, 새 방을 만들어 초대 코드를 공유하세요. ",-1))]),e("div",rt,[oe(x,{class:"btn btn-outline-light nav-hover",to:"/"},{default:ue(()=>[...t[13]||(t[13]=[de("메인으로",-1)])]),_:1}),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:A},"목록 새로고침")])]),e("div",it,[e("div",ct,[e("div",ut,[t[14]||(t[14]=e("p",{class:"text-white-50 small mb-1"},"내 상태",-1)),e("h6",dt,c(K(f)?K(f).user.username:"로그인 필요"),1),e("p",mt,c(K(f)?G.value?"익명/닉네임 선택 가능":"관리자 · 실명 발송":"로그인 후 참여 가능"),1)])]),e("div",vt,[e("div",ft,[t[15]||(t[15]=e("p",{class:"text-white-50 small mb-1"},"실시간 연결",-1)),e("div",pt,[e("span",{class:W(["pill",Q.value])},c(P.value),3),e("small",_t,c(p.error||"끊기면 자동으로 다시 연결합니다."),1)])])]),e("div",ht,[e("div",yt,[t[16]||(t[16]=e("p",{class:"text-white-50 small mb-1"},"현재 방",-1)),e("strong",bt,c(i.value?i.value.name:"아직 선택되지 않음"),1),e("small",wt,c(q.value),1)])])]),e("div",gt,[e("button",{class:W(["btn nav-hover",j.value==="global"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[0]||(t[0]=n=>j.value="global")}," 실시간 자유 채팅 ",2),e("button",{class:W(["btn nav-hover",j.value==="rooms"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[1]||(t[1]=n=>j.value="rooms")}," 채팅방 관리 ",2)]),j.value==="global"?(a(),o("div",kt,[oe(ot)])):(a(),o("div",xt,[t[29]||(t[29]=e("div",{class:"alert alert-info mb-4"}," 원하는 분위기의 방이 없다면 직접 만들고 링크를 공유하세요. 비공개 방은 목록에 표시되지 않고 비밀번호로만 입장합니다. ",-1)),e("div",$t,[e("div",St,[e("div",Rt,[e("div",Ct,[e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[t[17]||(t[17]=e("h5",{class:"text-light mb-0"},"공개 채팅방",-1)),e("button",{class:"btn btn-sm btn-outline-info nav-hover",type:"button",onClick:A},"새로고침")]),t[18]||(t[18]=e("p",{class:"text-white-50 small mb-3"},"목록에는 누구나 입장 가능한 공개형 채팅방만 표시됩니다.",-1)),U.value?(a(),o("div",Lt,"채팅방 목록을 불러오는 중...")):L.value?(a(),o("div",Tt,c(L.value),1)):(a(),o("div",At,[k.value.length?V("",!0):(a(),o("div",Et,"아직 공개 채팅방이 없습니다.")),(a(!0),o(ae,null,ne(k.value,n=>(a(),o("article",{key:n.id,class:"room-tile d-flex justify-content-between align-items-center"},[e("div",null,[e("p",Ut,c(n.name),1),e("small",Ot,c(n.member_count)+"/"+c(n.capacity)+" · "+c(n.owner_username||"운영자"),1)]),e("button",{class:W(["btn btn-sm nav-hover",n.is_member?"btn-secondary":"btn-outline-light"]),disabled:b.value===n.id||n.member_count>=n.capacity||n.is_member&&i.value&&i.value.id===n.id,type:"button",onClick:R=>ke(n)},[b.value===n.id?(a(),o("span",jt,"입장 중...")):n.is_member&&i.value&&i.value.id===n.id?(a(),o("span",Vt,"이용 중")):n.is_member?(a(),o("span",Wt,"입장 완료")):n.member_count>=n.capacity?(a(),o("span",Mt,"정원 초과")):(a(),o("span",Bt,"입장"))],10,Nt)]))),128))]))])]),e("div",Dt,[e("div",Pt,[t[24]||(t[24]=e("h5",{class:"text-light mb-3"},"채팅방 생성",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Z($e,["prevent"])},[e("div",It,[t[19]||(t[19]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>_.name=n),class:"form-control",maxlength:"50",placeholder:"예) 주말 영화 추천방",required:""},null,512),[[M,_.name]])]),e("div",Jt,[t[20]||(t[20]=e("label",{class:"form-label text-white-50"},"정원 (2~200명)",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>_.capacity=n),class:"form-control",min:"2",max:"200",type:"number",required:""},null,512),[[M,_.capacity,void 0,{number:!0}]])]),e("div",Kt,[C(e("input",{id:"createPrivate","onUpdate:modelValue":t[4]||(t[4]=n=>_.is_private=n),class:"form-check-input",type:"checkbox"},null,512),[[le,_.is_private]]),t[21]||(t[21]=e("label",{class:"form-check-label text-white-50",for:"createPrivate"},"비공개 채팅방",-1))]),_.is_private?(a(),o("div",Ft,[t[22]||(t[22]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),C(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>_.password=n),class:"form-control",type:"password",minlength:"4",required:""},null,512),[[M,_.password]]),t[23]||(t[23]=e("small",{class:"text-white-50"},"목록에 표시되지 않으며 비밀번호로만 입장합니다.",-1))])):V("",!0),e("div",qt,[e("button",{class:"btn btn-primary nav-hover w-100",disabled:D.value,type:"submit"},[D.value?(a(),o("span",Yt,"생성 중...")):(a(),o("span",zt,"채팅방 생성"))],8,Ht)])],32)])]),e("div",Gt,[e("div",Qt,[t[27]||(t[27]=e("h5",{class:"text-light mb-3"},"비공개 채팅방 입장",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Z(xe,["prevent"])},[e("div",Xt,[t[25]||(t[25]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>h.name=n),class:"form-control",placeholder:"예) 프로젝트 A",required:""},null,512),[[M,h.name]])]),e("div",Zt,[t[26]||(t[26]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>h.password=n),class:"form-control",type:"password",required:""},null,512),[[M,h.password]])]),e("div",es,[e("button",{class:"btn btn-outline-light nav-hover w-100",disabled:F.value,type:"submit"},[F.value?(a(),o("span",ss,"입장 중...")):(a(),o("span",os,"입장하기"))],8,ts)])],32)])])]),e("div",as,[e("div",ns,[e("div",ls,[e("div",rs,[e("div",null,[e("h5",is,c(i.value?i.value.name:"채팅방을 선택해 주세요"),1),e("p",cs,c(i.value?q.value:"좌측에서 채팅방을 선택하거나 새로 만들 수 있습니다."),1),i.value?(a(),o("p",us,c(P.value)+" · 끊기면 자동으로 재연결합니다. ",1)):V("",!0)]),e("div",ds,[oe(x,{class:"btn btn-outline-light btn-sm nav-hover",to:"/boards"},{default:ue(()=>[...t[28]||(t[28]=[de("게시판 보기",-1)])]),_:1}),i.value?(a(),o("button",{key:0,class:"btn btn-outline-danger btn-sm nav-hover",disabled:u.value,type:"button",onClick:Se},[u.value?(a(),o("span",vs,"나가는 중...")):(a(),o("span",fs,"채팅방 나가기"))],8,ms)):V("",!0)])]),S.value?(a(),o("div",ps,"채팅 메시지를 불러오는 중...")):i.value&&!$.value.length?(a(),o("div",_s," 아직 대화가 없습니다. 첫 메시지를 남겨보세요! ")):i.value?(a(),o("div",hs,[(a(!0),o(ae,null,ne($.value,n=>(a(),o("article",{key:n.id,class:"chat-message list-group-item"},[e("div",ys,[e("span",{class:W(["fw-semibold",{"text-warning":n.is_anonymous}])},c(n.display_name),3),e("small",null,c(te(n.created_at)),1)]),e("p",bs,c(n.content),1)]))),128))])):(a(),o("div",ws,"채팅방을 선택하거나 새로 만들어주세요.")),d.value?(a(),o("div",gs,c(d.value),1)):p.error?(a(),o("div",ks,c(p.error),1)):V("",!0),K(f)&&i.value?(a(),o("form",{key:6,class:"chat-form mt-auto",autocomplete:"off",onSubmit:Z(ie,["prevent"])},[w.value?(a(),o("p",Ss,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(a(),o("div",xs,[C(e("input",{id:"chatAnon","onUpdate:modelValue":t[8]||(t[8]=n=>m.is_anonymous=n),class:"form-check-input",type:"checkbox"},null,512),[[le,m.is_anonymous]]),e("label",$s,c(m.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),C(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=n=>m.content=n),class:"form-control",name:"chat-content",placeholder:"지금 떠오르는 생각을 적어보세요 (최대 500자)",maxlength:"500",onKeydown:Re},null,544),[[M,m.content]]),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:O.value||!H.value,type:"submit"},[O.value?(a(),o("span",Cs,"전송 중...")):(a(),o("span",Ls,"메시지 전송"))],8,Rs)],32)):K(f)?(a(),o("div",Ts," 채팅방에 입장해야 메시지를 보낼 수 있습니다. ")):(a(),o("div",As," 로그인한 사용자만 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])])])])]))])}}};export{Us as default};
