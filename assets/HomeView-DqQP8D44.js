import{r as u,w as O,o as Z,u as ee,a as se,c as i,b as e,n as h,t as o,d as te,e as K,f as _,g as ae,h as v,i as N,F as A,j as B,k as le,l as oe,v as ne,m as ie,p as re,q as ue,s as ce,x as de,y as ve,z as me,A as n,B as he,C as _e}from"./index-QGokFqsz.js";const fe={class:"panel mb-4 animate-[float_8s_ease-in-out_infinite]"},pe={class:"d-flex flex-column flex-lg-row justify-content-between gap-4"},be={class:"d-inline-flex align-items-center gap-2 mb-3 text-uppercase small fw-semibold"},ye={class:"d-flex flex-wrap gap-3"},ge={class:"mini-stats row row-cols-1 g-3"},we={class:"col"},xe={class:"card border-0 h-100 text-center py-3"},ke={class:"text-light mb-0"},Re={class:"col"},qe={class:"card border-0 h-100 text-center py-3"},Ae={class:"text-light mb-0"},Ce={class:"col"},Pe={class:"card border-0 h-100 text-center py-3"},Me={class:"text-light mb-0"},Le={class:"random-chat-header"},Se={class:"random-chat-tabs"},Te=["disabled"],Ne=["disabled"],Be={class:"random-status-row"},Ee={class:"status-pill"},De={class:"status-pill"},Ve={class:"status-pill"},Ie={class:"status-pill"},ze={key:0,class:"alert alert-success random-alert"},He={key:1,class:"alert alert-danger random-alert"},Oe={key:2,class:"alert alert-warning random-alert"},Ke={key:0,class:"random-stream"},Qe={key:1,class:"random-placeholder"},je=["disabled"],Ue={key:0},Fe={key:1},Je={class:"panel mb-4"},$e={key:0,class:"alert alert-danger"},Ge={key:1,class:"panel-placeholder"},We={key:2,class:"row g-4"},Xe={class:"card h-100 border-0 fade-card"},Ye={class:"card-body d-flex flex-column gap-2"},Ze={class:"badge bg-secondary text-uppercase w-auto"},es={class:"card-title text-light mb-0"},ss={class:"card-text text-white-50 flex-grow-1"},ts={class:"panel"},as={key:0,class:"row g-3"},ls={class:"card border-0 h-100 mini-stat-card"},os={class:"card-body"},ns={class:"text-white-50 mb-1"},is={class:"text-light mb-2"},rs={class:"text-white-50"},us={class:"mb-0 text-white-50"},cs={key:1,class:"panel-placeholder"},ds=2e3,vs="/random-chat.html",_s={__name:"HomeView",setup(ms){const C=u({ok:null,text:"API 상태 확인 중..."}),E=u([]),P=u([]),f=u({users:0,posts:0,messages:0}),M=u(!0),p=u(""),{profile:c,ensureProfileLoaded:Q}=ee(),L=u(null),a=u({in_queue:!1,queue_position:null,queue_size:0,active_sessions:0,session:null,messages:[]}),S=u("idle"),r=u(""),b=u(!1),y=u(!1),g=u(!1),m=u(!1),d=u(""),j=/010-\d{4}-\d{4}/,w=u("");let x=null;const k=(s,t)=>s?s.status===401?"랜덤 채팅은 로그인 후 이용할 수 있습니다.":s.status===404?"랜덤 채팅 서버가 아직 업데이트되지 않았습니다. 잠시 후 다시 시도해 주세요.":s?.payload?.detail||t:t,R=(s={})=>{a.value={in_queue:!!s?.in_queue,queue_position:s?.queue_position??null,queue_size:s?.queue_size??0,active_sessions:s?.active_sessions??0,session:s?.session||null,messages:Array.isArray(s?.messages)?s.messages:[]}},D=async()=>{M.value=!0,p.value="";try{const[s,t]=await Promise.all([ie(),re()]);C.value={ok:!!s?.ok,text:s?.ok?"API 정상 동작 중":"API 응답 이상"},E.value=Array.isArray(t?.sections)?t.sections:[],P.value=Array.isArray(t?.stats)?t.stats:[],f.value=t?.totals??{users:0,posts:0,messages:0}}catch(s){console.error(s),p.value="메인 데이터를 불러오지 못했습니다."}finally{M.value=!1}},V=()=>c.value?(r.value="",!0):(r.value="랜덤 채팅은 로그인 후 이용할 수 있습니다.",!1),I=async()=>{if(c.value){b.value=!0,r.value="";try{const s=await ve({limit:60});R(s)}catch(s){console.error(s),r.value=k(s,"랜덤 채팅 상태를 불러오지 못했습니다.")}finally{b.value=!1}}},T=async s=>{S.value=s,s==="queue"?await U():s==="match"&&await J()},U=async()=>{if(V()&&!y.value){y.value=!0,r.value="";try{const s=await ce();R(s),window.open(vs,"_blank","noopener")}catch(s){console.error(s),r.value=k(s,"대기열에 들어가지 못했습니다.")}finally{y.value=!1}}},F=async()=>{if(c.value){r.value="";try{await ue(),await I()}catch(s){console.error(s),r.value=k(s,"대기열에서 나갈 수 없습니다.")}}},J=async()=>{if(V()&&!g.value){g.value=!0,r.value="";try{const s=await de();R(s),d.value=""}catch(s){console.error(s),r.value=k(s,"랜덤 매칭에 실패했습니다.")}finally{g.value=!1}}},$=async()=>{if(!(!c.value||!a.value.session))try{const s=await _e({limit:60});Array.isArray(s?.messages)&&(a.value={...a.value,messages:s.messages})}catch(s){console.error(s)}},z=async()=>{if(!c.value||!a.value.session){r.value="매칭 후 메시지를 보낼 수 있습니다.";return}const s=d.value.trim();if(!s){r.value="메시지를 입력해 주세요.";return}if(j.test(s)){r.value="전화번호 형식(010-0000-0000)은 전송할 수 없습니다.";return}if(!m.value){m.value=!0,r.value="";try{const t=await me({content:s});a.value={...a.value,messages:[...a.value.messages,t]},d.value=""}catch(t){console.error(t),r.value=t?.payload?.detail||"메시지를 보내지 못했습니다."}finally{m.value=!1}}},G=s=>{s.key!=="Enter"||s.shiftKey||s.isComposing||(s.preventDefault(),z())},W=()=>{L.value&&L.value.scrollIntoView({behavior:"smooth",block:"start"})},X=async()=>{W(),await T("queue")},Y=()=>{q(),a.value.session&&(x=window.setInterval(()=>{$()},ds))},q=()=>{x&&(clearInterval(x),x=null)};return O(()=>a.value.session?.id,(s,t)=>{s!==t&&Y(),s||(q(),w.value=""),s&&s!==t&&(w.value="상대방과 연결되었습니다.")}),O(()=>c.value,s=>{s?I():(q(),R({}),d.value="")},{immediate:!0}),Z(async()=>{await Q(),D()}),se(()=>{q()}),(s,t)=>{const H=ae("router-link");return n(),i(A,null,[e("section",fe,[e("div",pe,[e("div",null,[e("div",be,[e("span",{class:h(["badge",C.value.ok?"bg-success":"bg-danger"])},null,2),e("span",null,o(C.value.text),1)]),t[4]||(t[4]=e("h1",{class:"display-5 fw-semibold text-light mb-3"},"익명 랜덤 채팅 허브",-1)),t[5]||(t[5]=e("p",{class:"text-white-50 mb-4"}," 대기열 진입부터 1:1 매칭, 메시지까지 한 화면에서 제어하세요. 연락처(010-0000-0000) 등 개인정보는 자동으로 차단됩니다. ",-1)),e("div",ye,[e("button",{class:"btn btn-primary btn-lg shadow nav-hover",type:"button",onClick:X}," 랜덤채팅 바로가기 "),te(H,{class:"btn btn-outline-light btn-lg nav-hover",to:"/chat"},{default:K(()=>[...t[3]||(t[3]=[_("공개 채팅방 보기",-1)])]),_:1})])]),e("div",ge,[e("div",we,[e("div",xe,[t[6]||(t[6]=e("p",{class:"text-white-50 mb-1"},"총 게시글",-1)),e("h2",ke,o(f.value.posts),1)])]),e("div",Re,[e("div",qe,[t[7]||(t[7]=e("p",{class:"text-white-50 mb-1"},"채팅 메시지",-1)),e("h2",Ae,o(f.value.messages),1)])]),e("div",Ce,[e("div",Pe,[t[8]||(t[8]=e("p",{class:"text-white-50 mb-1"},"계정 수",-1)),e("h2",Me,o(f.value.users),1)])])])])]),e("section",{ref_key:"randomPanelRef",ref:L,class:"panel random-chat-panel mb-4"},[e("div",Le,[t[9]||(t[9]=e("div",null,[e("span",{class:"random-chip"},"랜덤 채팅"),e("h2",{class:"random-title"},"한 번의 탭으로 익명 1:1 매칭"),e("p",{class:"random-subtitle"},[e("strong",null,"대기열 진입"),_("을 누르면 익명 대기열에 합류하고, "),e("strong",null,"채팅하기"),_("는 본인을 제외한 다른 이용자와 즉시 연결합니다. 모든 대화는 익명으로만 진행됩니다. ")])],-1)),e("div",Se,[e("button",{class:h(["random-chat-tab",{active:S.value==="queue"}]),disabled:y.value||b.value,type:"button",onClick:t[0]||(t[0]=l=>T("queue"))}," 대기열 진입 ",10,Te),e("button",{class:h(["random-chat-tab",{active:S.value==="match"}]),disabled:g.value||b.value,type:"button",onClick:t[1]||(t[1]=l=>T("match"))}," 채팅하기 ",10,Ne)])]),e("div",Be,[e("div",Ee,[t[10]||(t[10]=e("span",{class:"label"},"대기열",-1)),e("strong",null,o(a.value.queue_size)+"명",1)]),e("div",De,[t[11]||(t[11]=e("span",{class:"label"},"진행 중인 채팅",-1)),e("strong",null,o(a.value.active_sessions)+"개",1)]),e("div",Ve,[t[12]||(t[12]=e("span",{class:"label"},"내 순서",-1)),e("strong",null,o(a.value.queue_position??"-"),1)]),e("div",Ie,[t[13]||(t[13]=e("span",{class:"label"},"현재 상태",-1)),e("strong",null,o(a.value.session?a.value.session.partner_alias+" 연결됨":a.value.in_queue?"대기 중":"탭을 눌러 시작하세요"),1)]),a.value.in_queue?(n(),i("button",{key:0,class:"btn btn-outline-secondary nav-hover ms-auto random-leave-btn",type:"button",onClick:F}," 대기열 나가기 ")):v("",!0)]),w.value?(n(),i("div",ze,o(w.value),1)):v("",!0),r.value?(n(),i("div",He,o(r.value),1)):v("",!0),N(c)?v("",!0):(n(),i("div",Oe," 로그인한 사용자만 랜덤 채팅에 참여할 수 있습니다. 계정 탭에서 로그인해 주세요. ")),e("div",{class:h(["random-chat-body",{disabled:!N(c)}])},[a.value.session&&a.value.messages.length?(n(),i("div",Ke,[(n(!0),i(A,null,B(a.value.messages,l=>(n(),i("article",{key:l.id,class:h(["random-chat-message",{me:l.from_self}])},[e("small",null,o(l.from_self?"나":a.value.session.partner_alias),1),e("p",null,o(l.content),1),e("time",null,o(new Date(l.created_at).toLocaleTimeString("ko-KR")),1)],2))),128))])):(n(),i("div",Qe,o(a.value.session?"아직 대화가 없습니다. 첫 메시지를 보내보세요!":"대기열에 합류하고 채팅하기를 누르면 새로운 익명 채팅방이 열립니다."),1)),N(c)&&a.value.session?(n(),i("form",{key:2,class:"random-chat-form",autocomplete:"off",onSubmit:le(z,["prevent"])},[oe(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=l=>d.value=l),class:"form-control",maxlength:"500",placeholder:"010-0000-0000 형식의 연락처는 전송이 제한됩니다.",onKeydown:G},null,544),[[ne,d.value]]),e("button",{class:"btn btn-light nav-hover",disabled:m.value||!d.value.trim(),type:"submit"},[m.value?(n(),i("span",Ue,"전송 중...")):(n(),i("span",Fe,"메시지 전송"))],8,je)],32)):v("",!0)],2)],512),e("section",Je,[e("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t[14]||(t[14]=e("div",null,[e("h2",{class:"h4 text-light mb-1"},"애플리케이션 개요"),e("p",{class:"text-white-50 mb-0"},"각 영역은 독립 라우트/앱으로 나뉘어 있습니다.")],-1)),e("button",{class:"btn btn-outline-info nav-hover",type:"button",onClick:D},"새로 고침")]),p.value?(n(),i("div",$e,o(p.value),1)):M.value?(n(),i("div",Ge,"데이터를 불러오는 중...")):(n(),i("div",We,[(n(!0),i(A,null,B(E.value,l=>(n(),i("div",{key:l.id,class:"col-12 col-md-6 col-xl-3"},[e("div",Xe,[e("div",Ye,[e("span",Ze,o(l.slug),1),e("h5",es,o(l.title),1),e("p",ss,o(l.description),1),l.cta_link?(n(),he(H,{key:0,class:"btn btn-sm btn-outline-light align-self-start nav-hover",to:l.cta_link},{default:K(()=>[_(o(l.cta_label||"바로가기"),1)]),_:2},1032,["to"])):v("",!0)])])]))),128))]))]),e("section",ts,[t[15]||(t[15]=e("div",{class:"mb-3"},[e("h2",{class:"h4 text-light mb-1"},"운영 수치"),e("p",{class:"text-white-50 mb-0"},"DB, 백엔드, 프런트엔드가 공유하는 제약 조건입니다.")],-1)),P.value.length?(n(),i("div",as,[(n(!0),i(A,null,B(P.value,l=>(n(),i("div",{key:l.id,class:"col-12 col-md-6 col-xl-4"},[e("div",ls,[e("div",os,[e("p",ns,o(l.name),1),e("h3",is,[_(o(l.value)+" ",1),e("small",rs,o(l.unit),1)]),e("p",us,o(l.description),1)])])]))),128))])):(n(),i("p",cs,"등록된 지표가 없습니다."))])],64)}}};export{_s as default};
