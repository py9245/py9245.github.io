import{r as f,m as W,c as D,u as me,K as q,o as ve,L as fe,a as o,l as n,b as e,i as V,t as d,F as te,g as se,n as J,p as oe,s as Y,q as L,y as ne,v as B,M as xe,N as pe,O as ae,P as he,d as ee,w as re,e as ce,f as $e,Q as Se,R as Re}from"./index-BGVExaRN.js";const Ce={class:"card border-0"},Le={class:"card-body"},Ae={class:"d-flex flex-column flex-lg-row justify-content-between gap-3 mb-3"},Ee={class:"text-white-50 small mb-0"},Te={class:"text-white-50 small mb-0"},Ue={class:"d-flex gap-2 align-items-start"},Oe=["disabled"],Ne={key:0},Pe={key:1},Ve={key:0,class:"alert alert-danger"},Be={key:1,class:"alert alert-success"},We={key:0,class:"text-center text-white-50 my-5"},je={class:"d-flex justify-content-between align-items-center"},Ie={class:"mb-0 mt-1"},Me={key:2,class:"alert alert-warning mb-0"},De={key:3},Ke={class:"alert alert-info mb-3"},Fe={key:0,class:"form-check form-switch mb-3"},Je={class:"form-check-label text-white-50",for:"globalChatAnon"},qe={key:1,class:"text-white-50 small"},He={key:2,class:"alert alert-warning mt-2"},Ge=["disabled"],Ye={key:0},ze={key:1},Qe="오픈 라운지",ue=80,Xe=4e3,Ze={__name:"GlobalChatPanel",setup(_e){const{profile:y,ensureProfileLoaded:z}=me(),b=f(null),x=f([]),T=f(!1),A=f(!1),r=W({status:"idle",detail:"실시간 연결을 준비 중입니다."}),_=W({content:"",is_anonymous:!0}),c=W({error:"",info:"",form:""}),S=f(null),m=f(null);let C=null,U=!1;const u=D(()=>!!y.value?.user?.is_staff),w=D(()=>!!(y.value&&b.value&&_.content.trim())&&r.status==="open"),p=D(()=>{const i=y.value?.user;if(!i)return"";const l=i.email||"이메일 정보 없음";return`${i.username} 님으로 접속 중입니다. (${l})`}),j={idle:"실시간 연결을 준비 중입니다.",connecting:"실시간 연결을 준비 중입니다...",open:"실시간 연결됨 · 새 메시지가 자동으로 표시됩니다.",closed:"실시간 연결이 끊어졌습니다. 잠시 후 재시도합니다."},h=(i,l)=>{r.status=i,r.detail=l||j[i]||""},E=f((()=>{if(typeof window>"u")return null;const i=(window.location.hostname||"").toLowerCase(),l=i.includes("github.io")||i.includes("githubusercontent.com");let v=window.API_BASE_URL||void 0||"/api";l&&(v=window.API_BASE_URL||"https://3-37-130-181.nip.io/api");try{const $=new URL(v,window.location.origin);return`${$.protocol==="https:"?"wss:":"ws:"}//${$.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})()),O=()=>{xe(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})},k=()=>{if(U=!1,C&&(clearTimeout(C),C=null),m.value)try{m.value.close()}catch{}m.value=null,y.value?h("idle"):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")},Q=()=>{const i=he();return!i||!b.value||!E.value?null:`${E.value}/ws/chatrooms/${b.value.id}/?token=${encodeURIComponent(i)}`},N=i=>{if(!m.value||m.value.readyState!==WebSocket.OPEN)return c.error="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해주세요.",h("connecting"),!1;try{return m.value.send(JSON.stringify(i)),!0}catch(l){return console.error("WebSocket 전송 오류",l),c.error="실시간 메시지를 전송하지 못했습니다.",!1}},H=()=>{c.error="",N({action:"fetch_history"})||(c.info="")},X=i=>{try{const l=JSON.parse(i.data);l.event==="history"?(x.value=Array.isArray(l.messages)?l.messages.slice(-ue):[],O(),c.info=""):l.event==="message"?l.message&&(x.value=[...x.value,l.message].slice(-ue),O()):l.event==="error"&&(c.error=l.detail||"실시간 채팅 오류가 발생했습니다.")}catch(l){console.error("WebSocket 메시지 파싱 실패",l)}},P=()=>{if(!y.value||!b.value){k();return}const i=Q();if(!i){c.error="실시간 연결 정보를 계산하지 못했습니다.";return}k(),U=!0,h("connecting"),m.value=new WebSocket(i),m.value.addEventListener("open",()=>{h("open"),c.info="실시간 연결이 완료되었습니다.",H()}),m.value.addEventListener("message",X),m.value.addEventListener("close",()=>{m.value=null,U&&y.value&&b.value?(h("closed"),C=window.setTimeout(()=>{C=null,P()},Xe)):h("idle")}),m.value.addEventListener("error",l=>{console.error("WebSocket error",l),c.error="실시간 연결 중 문제가 발생했습니다."})},I=async()=>{const i=await pe(),l=Array.isArray(i?.rooms)?i.rooms:[];if(!l.length)throw new Error("입장 가능한 공개 채팅방이 없습니다.");let v=l.find($=>$.name===Qe)||l.find($=>!$.is_private)||l[0];if(!v)throw new Error("입장 가능한 공개 채팅방이 없습니다.");return v.is_member||(v=(await ae({name:v.name}))?.room||v),v},G=async()=>{if(!y.value){k();return}T.value=!0,c.error="",c.info="";try{const i=await I();b.value=i,x.value=[],P()}catch(i){console.error(i),b.value=null,c.error=i?.message||"채팅방 정보를 불러오지 못했습니다."}finally{T.value=!1}},F=()=>{if(c.form="",!y.value){c.form="로그인 후 이용해 주세요.";return}if(!b.value){c.form="입장 가능한 공개 채팅방이 없습니다.";return}const i=_.content.trim();if(!i){c.form="메시지를 입력해 주세요.";return}const l={action:"send_message",content:i,is_anonymous:u.value?!1:_.is_anonymous};A.value=!0,N(l)&&(_.content=""),A.value=!1},Z=i=>{i.key!=="Enter"||i.shiftKey||i.isComposing||(i.preventDefault(),F())};return q(y,(i,l)=>{i?l||(_.is_anonymous=!u.value,G()):(_.content="",_.is_anonymous=!0,b.value=null,x.value=[],k(),h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다."))},{immediate:!1}),q(u,i=>{i&&(_.is_anonymous=!1)},{immediate:!0}),q(x,O),ve(async()=>{await z(),y.value?(_.is_anonymous=!u.value,await G()):h("idle","로그인 후 실시간 자유 채팅을 이용할 수 있습니다.")}),fe(()=>{k()}),(i,l)=>(n(),o("div",Ce,[e("div",Le,[e("div",Ae,[e("div",null,[l[2]||(l[2]=e("h5",{class:"text-light mb-1"},"실시간 자유 채팅",-1)),l[3]||(l[3]=e("p",{class:"text-white-50 mb-0"}," 누구나 참여할 수 있는 공개 채팅방입니다. 새 메시지는 실시간으로 표시됩니다. ",-1)),e("p",Ee,d(b.value?`${b.value.name} · 정원 ${b.value.member_count}/${b.value.capacity}`:"채팅방 준비 중"),1),e("p",Te,d(r.detail),1)]),e("div",Ue,[e("button",{class:"btn btn-outline-info nav-hover",disabled:T.value,type:"button",onClick:G},[T.value?(n(),o("span",Ne,"준비 중...")):(n(),o("span",Pe,"다시 연결"))],8,Oe),e("button",{class:"btn btn-outline-light nav-hover",type:"button",onClick:H},"즉시 새로고침")])]),c.error?(n(),o("div",Ve,d(c.error),1)):c.info?(n(),o("div",Be,d(c.info),1)):V("",!0),e("div",{ref_key:"messageContainer",ref:S,class:"chat-messages list-group list-group-flush mb-3",style:{"max-height":"420px","overflow-y":"auto"}},[x.value.length?V("",!0):(n(),o("p",We,"아직 대화가 없습니다. 첫 메시지를 남겨보세요!")),(n(!0),o(te,null,se(x.value,v=>(n(),o("article",{key:v.id,class:"list-group-item bg-transparent text-light"},[e("div",je,[e("span",{class:J(["fw-semibold",{"text-warning":v.is_anonymous}])},d(v.display_name||(v.is_anonymous?"익명":"사용자")),3),e("small",null,d(new Date(v.created_at).toLocaleString("ko-KR",{dateStyle:"short",timeStyle:"short"})),1)]),e("p",Ie,d(v.content),1)]))),128))],512),oe(y)?(n(),o("div",De,[e("div",Ke,d(p.value),1),e("form",{autocomplete:"off",onSubmit:Y(F,["prevent"])},[u.value?(n(),o("p",qe,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(n(),o("div",Fe,[L(e("input",{id:"globalChatAnon","onUpdate:modelValue":l[0]||(l[0]=v=>_.is_anonymous=v),class:"form-check-input",type:"checkbox"},null,512),[[ne,_.is_anonymous]]),e("label",Je,d(_.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),L(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=v=>_.content=v),class:"form-control",placeholder:"지금 떠오르는 이야기를 적어보세요 (최대 500자)",maxlength:"500",rows:"4",onKeydown:Z},null,544),[[B,_.content]]),c.form?(n(),o("div",He,d(c.form),1)):V("",!0),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:A.value||!w.value,type:"submit"},[A.value?(n(),o("span",Ye,"전송 중...")):(n(),o("span",ze,"메시지 전송"))],8,Ge)],32)])):(n(),o("div",Me," 로그인한 사용자만 자유 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])]))}},et={class:"panel"},tt={class:"d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3 mb-4"},st={class:"nav nav-pills gap-2 mb-4 flex-wrap"},ot={key:0},nt={key:1,class:"row g-4"},at={class:"col-12 col-lg-4"},lt={class:"card border-0 mb-4"},it={class:"card-body"},rt={key:0,class:"alert alert-info"},ct={key:1,class:"alert alert-danger"},ut={key:2,class:"list-group list-group-flush"},dt={key:0,class:"list-group-item bg-transparent text-white-50"},mt={class:"mb-0 fw-semibold"},vt={class:"text-white-50"},ft=["disabled","onClick"],pt={key:0},ht={key:1},_t={key:2},yt={key:3},bt={key:4},wt={class:"card border-0 mb-4"},gt={class:"card-body"},kt={class:"col-12"},xt={class:"col-12"},$t={class:"col-12 form-check form-switch"},St={key:0,class:"col-12"},Rt={class:"col-12"},Ct=["disabled"],Lt={key:0},At={key:1},Et={class:"card border-0"},Tt={class:"card-body"},Ut={class:"col-12"},Ot={class:"col-12"},Nt={class:"col-12"},Pt=["disabled"],Vt={key:0},Bt={key:1},Wt={class:"col-12 col-lg-8"},jt={class:"card border-0 h-100"},It={class:"card-body d-flex flex-column gap-3 h-100"},Mt={class:"d-flex justify-content-between align-items-center"},Dt={class:"text-light mb-1"},Kt={class:"text-white-50 mb-0"},Ft={key:0,class:"text-white-50 small mb-0"},Jt={class:"d-flex gap-2"},qt=["disabled"],Ht={key:0},Gt={key:1},Yt={key:0,class:"alert alert-info"},zt={key:1,class:"alert alert-secondary"},Qt={key:2,class:"chat-messages list-group list-group-flush"},Xt={class:"d-flex justify-content-between"},Zt={class:"mt-1"},es={key:3,class:"alert alert-warning"},ts={key:4,class:"alert alert-danger"},ss={key:5,class:"alert alert-warning"},os={key:0,class:"form-check form-switch mb-3"},ns={class:"form-check-label text-white-50",for:"chatAnon"},as={key:1,class:"text-white-50 small"},ls=["disabled"],is={key:0},rs={key:1},cs={key:7,class:"alert alert-info mt-auto"},us={key:8,class:"alert alert-warning mt-auto"},de=80,ms={__name:"ChatView",setup(_e){const{profile:y,ensureProfileLoaded:z}=me(),b=D(()=>!!y.value?.user?.is_staff),x=f([]),T=f(!1),A=f(""),r=f(null),_=f(null),c=f(!1),S=f([]),m=W({content:"",is_anonymous:!0}),C=f(!1),U=f(!1),u=f(""),w=W({status:"idle",error:""}),p=W({name:"",capacity:10,is_private:!1,password:""}),j=f(!1),h=W({name:"",password:""}),K=f(!1);let E=null,O=!1;const k=f(null),Q=D(()=>!b.value),N=f("global"),H=s=>{if(!s)return"";const t=typeof s=="string"?new Date(s):s;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"short",timeStyle:"short"}).format(t)},X=D(()=>!!(y.value&&r.value&&m.content.trim())&&w.status==="open"),P=async()=>{T.value=!0,A.value="";try{const s=await pe();x.value=Array.isArray(s?.rooms)?s.rooms:[]}catch(s){console.error(s),A.value="채팅방 목록을 불러오지 못했습니다."}finally{T.value=!1}},I=s=>{r.value=s||null},F=(()=>{if(typeof window>"u")return null;const s=(window.location.hostname||"").toLowerCase(),t=s.includes("github.io")||s.includes("githubusercontent.com");let g=window.API_BASE_URL||void 0||"/api";t&&(g=window.API_BASE_URL||"https://3-37-130-181.nip.io/api");try{const a=new URL(g,window.location.origin);return`${a.protocol==="https:"?"wss:":"ws:"}//${a.host}`}catch{return window.location?.host?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`:null}})(),Z=s=>{const t=he();return!t||!F?null:`${F}/ws/chatrooms/${s}/?token=${encodeURIComponent(t)}`},i=()=>{E&&(clearTimeout(E),E=null)},l=()=>{if(O=!1,i(),k.value)try{k.value.close()}catch{}k.value=null,r.value?w.status="closed":w.status="idle"},v=()=>{!O||E||(E=window.setTimeout(()=>{E=null,r.value&&$(r.value.id)},3e3))},$=s=>{if(l(),!s)return;const t=Z(s);if(!t){u.value="로그인 후 이용해 주세요.";return}O=!0,w.status="connecting",w.error="",C.value=!0;const g=new WebSocket(t);k.value=g,g.addEventListener("open",()=>{w.status="open",w.error="",g.send(JSON.stringify({action:"fetch_history"}))}),g.addEventListener("message",a=>{try{const R=JSON.parse(a.data);if(R.event==="history")S.value=Array.isArray(R.messages)?R.messages.slice(-de):[],C.value=!1;else if(R.event==="message"){const ie=R.message;ie&&(S.value=[...S.value,ie].slice(-de))}else R.event==="error"&&(u.value=R.detail||"실시간 채팅 오류가 발생했습니다.")}catch(R){console.error("WebSocket message parse error",R)}}),g.addEventListener("close",()=>{k.value=null,O&&r.value?(w.status="closed",v()):w.status=r.value?"closed":"idle"}),g.addEventListener("error",a=>{console.error("WebSocket error",a),w.error="실시간 연결에 문제가 발생했습니다."})};q(b,s=>{s&&(m.is_anonymous=!1)},{immediate:!0}),q(r,s=>{S.value=[],u.value="",s?$(s.id):(l(),C.value=!1)});const M=()=>y.value?!0:(u.value="로그인 후 이용해 주세요.",!1),ye=async s=>{if(M()){_.value=s.id,u.value="";try{const t=await ae({name:s.name});I(t?.room??null),s.is_private||await P()}catch(t){console.error(t),u.value=t?.payload?.detail||"채팅방에 입장하지 못했습니다."}finally{_.value=null}}},be=async()=>{if(M()){if(!h.name.trim()){u.value="비공개 채팅방 이름을 입력해주세요.";return}if(!h.password.trim()){u.value="비공개 채팅방 비밀번호를 입력해주세요.";return}K.value=!0,u.value="";try{const s=await ae({name:h.name.trim(),password:h.password});I(s?.room??null),h.name="",h.password=""}catch(s){console.error(s),u.value=s?.payload?.detail||"비공개 채팅방에 입장하지 못했습니다."}finally{K.value=!1}}},we=async()=>{if(M()){j.value=!0,u.value="";try{const s=await Re({name:p.name.trim(),capacity:Number(p.capacity),is_private:p.is_private,password:p.is_private?p.password:""});if(!s?.room)throw new Error("채팅방 응답이 없습니다.");I(s.room),s.room.is_private||await P(),p.name="",p.password="",p.capacity=10,p.is_private=!1}catch(s){console.error(s),u.value=s?.payload?.detail||(s?.payload&&typeof s.payload=="object"?Object.values(s.payload).flat().join(" "):"채팅방을 생성하지 못했습니다.")}finally{j.value=!1}}},ge=async()=>{if(!(!r.value||!M())){c.value=!0,u.value="";try{await Se(r.value.id),l(),I(null),await P()}catch(s){console.error(s),u.value=s?.payload?.detail||"채팅방에서 나가지 못했습니다."}finally{c.value=!1}}},le=()=>{if(!M())return;if(!r.value){u.value="먼저 채팅방에 입장해 주세요.";return}if(w.status!=="open"||!k.value){u.value="실시간 연결을 준비 중입니다. 잠시 후 다시 시도해 주세요.",r.value&&$(r.value.id);return}const s=m.content.trim();if(!s){u.value="메시지를 입력해 주세요.";return}U.value=!0;const t={action:"send_message",content:s,is_anonymous:Q.value?m.is_anonymous:!1};try{k.value.send(JSON.stringify(t)),m.content="",u.value=""}catch(g){console.error(g),u.value="메시지를 전송하지 못했습니다."}finally{U.value=!1}},ke=s=>{s.key!=="Enter"||s.shiftKey||s.isComposing||(s.preventDefault(),le())};return ve(async()=>{await z(),await P()}),fe(()=>{l()}),(s,t)=>{const g=$e("router-link");return n(),o("section",et,[e("div",tt,[t[11]||(t[11]=e("div",null,[e("h2",{class:"h4 text-light mb-1"},"공개 채팅 라운지"),e("p",{class:"text-white-50 mb-0"},"실시간 자유 채팅과 채팅방 관리를 한 화면에서 이어서 이용할 수 있습니다.")],-1)),ee(g,{class:"btn btn-outline-light nav-hover",to:"/chat"},{default:re(()=>[...t[10]||(t[10]=[ce("화면 새로고침",-1)])]),_:1})]),e("div",st,[e("button",{class:J(["btn nav-hover",N.value==="global"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[0]||(t[0]=a=>N.value="global")}," 실시간 자유 채팅 ",2),e("button",{class:J(["btn nav-hover",N.value==="rooms"?"btn-primary":"btn-outline-light"]),type:"button",onClick:t[1]||(t[1]=a=>N.value="rooms")}," 채팅방 관리 ",2)]),N.value==="global"?(n(),o("div",ot,[ee(Ze)])):(n(),o("div",nt,[e("div",at,[e("div",lt,[e("div",it,[t[12]||(t[12]=e("h5",{class:"text-light mb-3"},"공개 채팅방",-1)),t[13]||(t[13]=e("p",{class:"text-white-50 small mb-3"},"목록에는 누구나 입장 가능한 공개형 채팅방만 표시됩니다.",-1)),T.value?(n(),o("div",rt,"채팅방 목록을 불러오는 중...")):A.value?(n(),o("div",ct,d(A.value),1)):(n(),o("ul",ut,[x.value.length?V("",!0):(n(),o("li",dt," 아직 공개 채팅방이 없습니다. ")),(n(!0),o(te,null,se(x.value,a=>(n(),o("li",{key:a.id,class:"list-group-item d-flex justify-content-between align-items-center bg-transparent text-light"},[e("div",null,[e("p",mt,d(a.name),1),e("small",vt,d(a.member_count)+"/"+d(a.capacity)+" · "+d(a.owner_username||"운영자"),1)]),e("button",{class:J(["btn btn-sm nav-hover",a.is_member?"btn-secondary":"btn-outline-light"]),disabled:_.value===a.id||a.member_count>=a.capacity||a.is_member&&r.value&&r.value.id===a.id,type:"button",onClick:R=>ye(a)},[_.value===a.id?(n(),o("span",pt,"입장 중...")):a.is_member&&r.value&&r.value.id===a.id?(n(),o("span",ht,"이용 중")):a.is_member?(n(),o("span",_t,"입장 완료")):a.member_count>=a.capacity?(n(),o("span",yt,"정원 초과")):(n(),o("span",bt,"입장"))],10,ft)]))),128))])),e("button",{class:"btn btn-outline-info nav-hover mt-3 w-100",type:"button",onClick:P},"새로 고침")])]),e("div",wt,[e("div",gt,[t[19]||(t[19]=e("h5",{class:"text-light mb-3"},"채팅방 생성",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Y(we,["prevent"])},[e("div",kt,[t[14]||(t[14]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),L(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>p.name=a),class:"form-control",maxlength:"50",required:""},null,512),[[B,p.name]])]),e("div",xt,[t[15]||(t[15]=e("label",{class:"form-label text-white-50"},"정원 (2~200명)",-1)),L(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>p.capacity=a),class:"form-control",min:"2",max:"200",type:"number",required:""},null,512),[[B,p.capacity,void 0,{number:!0}]])]),e("div",$t,[L(e("input",{id:"createPrivate","onUpdate:modelValue":t[4]||(t[4]=a=>p.is_private=a),class:"form-check-input",type:"checkbox"},null,512),[[ne,p.is_private]]),t[16]||(t[16]=e("label",{class:"form-check-label text-white-50",for:"createPrivate"},"비공개 채팅방",-1))]),p.is_private?(n(),o("div",St,[t[17]||(t[17]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),L(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>p.password=a),class:"form-control",type:"password",minlength:"4",required:""},null,512),[[B,p.password]]),t[18]||(t[18]=e("small",{class:"text-white-50"},"비공개 채팅방은 목록에 표시되지 않으며 비밀번호로만 입장합니다.",-1))])):V("",!0),e("div",Rt,[e("button",{class:"btn btn-primary nav-hover w-100",disabled:j.value,type:"submit"},[j.value?(n(),o("span",Lt,"생성 중...")):(n(),o("span",At,"채팅방 생성"))],8,Ct)])],32)])]),e("div",Et,[e("div",Tt,[t[22]||(t[22]=e("h5",{class:"text-light mb-3"},"비공개 채팅방 입장",-1)),e("form",{class:"row g-3",autocomplete:"off",onSubmit:Y(be,["prevent"])},[e("div",Ut,[t[20]||(t[20]=e("label",{class:"form-label text-white-50"},"채팅방 이름",-1)),L(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>h.name=a),class:"form-control",placeholder:"예) 프로젝트 A",required:""},null,512),[[B,h.name]])]),e("div",Ot,[t[21]||(t[21]=e("label",{class:"form-label text-white-50"},"비밀번호",-1)),L(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>h.password=a),class:"form-control",type:"password",required:""},null,512),[[B,h.password]])]),e("div",Nt,[e("button",{class:"btn btn-outline-light nav-hover w-100",disabled:K.value,type:"submit"},[K.value?(n(),o("span",Vt,"입장 중...")):(n(),o("span",Bt,"입장하기"))],8,Pt)])],32)])])]),e("div",Wt,[e("div",jt,[e("div",It,[e("div",Mt,[e("div",null,[e("h5",Dt,d(r.value?r.value.name:"채팅방을 선택해 주세요"),1),e("p",Kt,d(r.value?`정원 ${r.value.member_count}/${r.value.capacity} · ${r.value.is_private?"비공개":"공개"}`:"좌측에서 채팅방을 선택하거나 새로 만들 수 있습니다."),1),r.value?(n(),o("p",Ft,d(w.status==="open"?"실시간 연결됨":w.status==="connecting"?"실시간 연결 중...":"실시간 연결이 끊어져 재시도 중입니다."),1)):V("",!0)]),e("div",Jt,[ee(g,{class:"btn btn-outline-light btn-sm nav-hover",to:"/boards"},{default:re(()=>[...t[23]||(t[23]=[ce("게시판 보기",-1)])]),_:1}),r.value?(n(),o("button",{key:0,class:"btn btn-outline-danger btn-sm nav-hover",disabled:c.value,type:"button",onClick:ge},[c.value?(n(),o("span",Ht,"나가는 중...")):(n(),o("span",Gt,"채팅방 나가기"))],8,qt)):V("",!0)])]),C.value?(n(),o("div",Yt,"채팅 메시지를 불러오는 중...")):r.value&&!S.value.length?(n(),o("div",zt," 아직 대화가 없습니다. 첫 메시지를 남겨보세요! ")):r.value?(n(),o("div",Qt,[(n(!0),o(te,null,se(S.value,a=>(n(),o("article",{key:a.id,class:"chat-message list-group-item"},[e("div",Xt,[e("span",{class:J(["fw-semibold",{"text-warning":a.is_anonymous}])},d(a.display_name),3),e("small",null,d(H(a.created_at)),1)]),e("p",Zt,d(a.content),1)]))),128))])):(n(),o("div",es,"채팅방을 선택하거나 새로 만들어주세요.")),u.value?(n(),o("div",ts,d(u.value),1)):w.error?(n(),o("div",ss,d(w.error),1)):V("",!0),oe(y)&&r.value?(n(),o("form",{key:6,class:"chat-form mt-auto",autocomplete:"off",onSubmit:Y(le,["prevent"])},[b.value?(n(),o("p",as,"관리자는 실명(아이디)으로만 메시지를 보낼 수 있습니다.")):(n(),o("div",os,[L(e("input",{id:"chatAnon","onUpdate:modelValue":t[8]||(t[8]=a=>m.is_anonymous=a),class:"form-check-input",type:"checkbox"},null,512),[[ne,m.is_anonymous]]),e("label",ns,d(m.is_anonymous?"익명으로 보내기":"아이디 공개"),1)])),L(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=a=>m.content=a),class:"form-control",name:"chat-content",placeholder:"지금 떠오르는 생각을 적어보세요 (최대 500자)",maxlength:"500",onKeydown:ke},null,544),[[B,m.content]]),e("button",{class:"btn btn-primary nav-hover mt-3",disabled:U.value||!X.value,type:"submit"},[U.value?(n(),o("span",is,"전송 중...")):(n(),o("span",rs,"메시지 전송"))],8,ls)],32)):oe(y)?(n(),o("div",cs," 채팅방에 입장해야 메시지를 보낼 수 있습니다. ")):(n(),o("div",us," 로그인한 사용자만 채팅에 참여할 수 있습니다. 계정 페이지에서 로그인해 주세요. "))])])])]))])}}};export{ms as default};
